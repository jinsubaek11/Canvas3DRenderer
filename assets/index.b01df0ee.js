var Mn=Object.defineProperty;var Nn=(t,i,e)=>i in t?Mn(t,i,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[i]=e;var g=(t,i,e)=>(Nn(t,typeof i!="symbol"?i+"":i,e),e);(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const r of a)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function e(a){const r={};return a.integrity&&(r.integrity=a.integrity),a.referrerpolicy&&(r.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?r.credentials="include":a.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(a){if(a.ep)return;a.ep=!0;const r=e(a);fetch(a.href,r)}})();class b{static convertVec3ToVec4(i){return new Vt(i.x,i.y,i.z,1)}static convertVec4ToVec3(i){return new v(i.x/i.w,i.y/i.w,i.z/i.w)}static multiplyMatrix4x4(i,e){const n=i.data[0]*e.x+i.data[1]*e.y+i.data[2]*e.z+i.data[3]*e.w,a=i.data[4]*e.x+i.data[5]*e.y+i.data[6]*e.z+i.data[7]*e.w,r=i.data[8]*e.x+i.data[9]*e.y+i.data[10]*e.z+i.data[11]*e.w,o=i.data[12]*e.x+i.data[13]*e.y+i.data[14]*e.z+i.data[15]*e.w;return new Vt(n,a,r,o)}static rotateXvec3(i,e){const n=new v;return n.x=i.x,n.y=Math.cos(e)*i.y-Math.sin(e)*i.z,n.z=Math.sin(e)*i.y+Math.cos(e)*i.z,n}static rotateYvec3(i,e){const n=new v;return n.x=Math.cos(e)*i.x+Math.sin(e)*i.z,n.y=i.y,n.z=-Math.sin(e)*i.x+Math.cos(e)*i.z,n}static rotateZvec3(i,e){const n=new v;return n.x=Math.cos(e)*i.x-Math.sin(e)*i.y,n.y=Math.sin(e)*i.x+Math.cos(e)*i.y,n.z=i.z,n}static subtractVec2(i,e){const n=new Ot;return n.x=i.x-e.x,n.y=i.y-e.y,n}static subtractVec3(i,e){const n=new v;return n.x=i.x-e.x,n.y=i.y-e.y,n.z=i.z-e.z,n}static addVec3(i,e){const n=new v;return n.x=i.x+e.x,n.y=i.y+e.y,n.z=i.z+e.z,n}static multiplyScalar(i,e){const n=new v;return n.x=i.x*e,n.y=i.y*e,n.z=i.z*e,n}static dotVec3(i,e){return i.x*e.x+i.y*e.y+i.z*e.z}static crossVec3(i,e){const n=new v;return n.x=i.y*e.z-i.z*e.y,n.y=i.z*e.x-i.x*e.z,n.z=i.x*e.y-i.y*e.x,n}static normalizeVec3(i){const e=new v,n=this.magnitudeVec3(i);return e.x=i.x/n,e.y=i.y/n,e.z=i.z/n,e}static magnitudeVec3(i){return Math.sqrt(i.x*i.x+i.y*i.y+i.z*i.z)}}class Ot{constructor(i=0,e=0){g(this,"_x");g(this,"_y");this._x=i,this._y=e}get x(){return this._x}get y(){return this._y}set x(i){this._x=i}set y(i){this._y=i}}class v{constructor(i=0,e=0,n=0){g(this,"_x");g(this,"_y");g(this,"_z");this._x=i,this._y=e,this._z=n}get x(){return this._x}get y(){return this._y}get z(){return this._z}set x(i){this._x=i}set y(i){this._y=i}set z(i){this._z=i}}class Vt{constructor(i=0,e=0,n=0,a=1){g(this,"_x");g(this,"_y");g(this,"_z");g(this,"_w");this._x=i,this._y=e,this._z=n,this._w=a}get x(){return this._x}get y(){return this._y}get z(){return this._z}get w(){return this._w}set x(i){this._x=i}set y(i){this._y=i}set z(i){this._z=i}set w(i){this._w=i}}const q=t=>Math.PI*t/180,Bn=t=>t/Math.PI*180,Nt=(t,i,e)=>(1-e)*t+i*e,On=(t,i,e,n)=>{const a=b.subtractVec2(e,t),r=b.subtractVec2(i,t),o=b.subtractVec2(e,n),l=b.subtractVec2(i,n),f=b.subtractVec2(n,t),s=a.x*r.y-a.y*r.x,h=(o.x*l.y-o.y*l.x)/s,w=(a.x*f.y-a.y*f.x)/s,_=1-h-w;return new v(h,w,_)},R=class{static init(){return this._canvasView=document.getElementById("canvas"),this._canvasViewCtx=this._canvasView.getContext("2d"),this._canvasColorBuffer=document.createElement("canvas"),this._canvasColorBufferCtx=this._canvasColorBuffer.getContext("2d"),this._zBuffer=Array(window.innerWidth*window.innerHeight).fill(1),this._canvasViewCtx&&this._canvasColorBufferCtx?(this.resize(),this.bindEvents(),!0):!1}static resize(){this._canvasView.width=window.innerWidth,this._canvasView.height=window.innerHeight,this._canvasColorBuffer.width=window.innerWidth,this._canvasColorBuffer.height=window.innerHeight,this._zBuffer=new Array(window.innerWidth*window.innerHeight).fill(1)}static bindEvents(){window.addEventListener("resize",()=>this.resize())}static clearZbuffer(){this._zBuffer=new Array(window.innerWidth*window.innerHeight).fill(1)}static drawTriangle(i,e,n,a,r,o,l){!R._canvasColorBufferCtx||(R._canvasColorBufferCtx.beginPath(),R._canvasColorBufferCtx.moveTo(i,e),R._canvasColorBufferCtx.lineTo(n,a),R._canvasColorBufferCtx.lineTo(r,o),R._canvasColorBufferCtx.closePath(),R._canvasColorBufferCtx.strokeStyle=l,R._canvasColorBufferCtx.stroke())}static drawTexturedTriangle(i,e,n,a,r,o,l,f,s,h,w,_,d,p,z,E,m,A,S){const c={x:i,y:e,z:n,w:a,u:r,v:o},u={x:l,y:f,z:s,w:h,u:w,v:_},y={x:d,y:p,z,w:E,u:m,v:A};if(c.y>u.y){const O=c.x,V=c.y,I=c.z,D=c.w,Ut=c.u,Mt=c.v;c.x=u.x,c.y=u.y,c.z=u.z,c.w=u.w,c.u=u.u,c.v=u.v,u.x=O,u.y=V,u.z=I,u.w=D,u.u=Ut,u.v=Mt}if(u.y>y.y){const O=y.x,V=y.y,I=y.z,D=y.w,Ut=y.u,Mt=y.v;y.x=u.x,y.y=u.y,y.z=u.z,y.w=u.w,y.u=u.u,y.v=u.v,u.x=O,u.y=V,u.z=I,u.w=D,u.u=Ut,u.v=Mt}if(c.y>u.y){const O=c.x,V=c.y,I=c.z,D=c.w,Ut=c.u,Mt=c.v;c.x=u.x,c.y=u.y,c.z=u.z,c.w=u.w,c.u=u.u,c.v=u.v,u.x=O,u.y=V,u.z=I,u.w=D,u.u=Ut,u.v=Mt}c.v=1-c.v,u.v=1-u.v,y.v=1-y.v;const x=new Vt(c.x,c.y,c.z,c.w),N=new Vt(u.x,u.y,u.z,u.w),T=new Vt(y.x,y.y,y.z,y.w);let k=0,C=0;if(u.y-c.y!=0&&(k=(u.x-c.x)/Math.abs(u.y-c.y)),y.y-c.y!=0&&(C=(y.x-c.x)/Math.abs(y.y-c.y)),u.y-c.y!=0)for(let O=c.y;O<=u.y;O++){let V=u.x+(O-u.y)*k,I=c.x+(O-c.y)*C;if(I<V){let D=V;V=I,I=D}for(let D=V;D<I;D++)R.drawTexel(D,O,S,x,N,T,c.u,c.v,u.u,u.v,y.u,y.v)}if(k=0,C=0,y.y-u.y!=0&&(k=(y.x-u.x)/Math.abs(y.y-u.y)),y.y-c.y!=0&&(C=(y.x-c.x)/Math.abs(y.y-c.y)),y.y-u.y!=0)for(let O=u.y;O<=y.y;O++){let V=u.x+(O-u.y)*k,I=c.x+(O-c.y)*C;if(I<V){let D=V;V=I,I=D}for(let D=V;D<I;D++)this.drawTexel(D,O,S,x,N,T,c.u,c.v,u.u,u.v,y.u,y.v)}}static drawFilledTriangle(i,e,n,a,r,o,l){const f={x:i,y:e},s={x:n,y:a},h={x:r,y:o};if(f.y>s.y){const w=f.x,_=f.y;f.x=s.x,f.y=s.y,s.x=w,s.y=_}if(s.y>h.y){const w=h.x,_=h.y;h.x=s.x,h.y=s.y,s.x=w,s.y=_}if(f.y>s.y){const w=f.x,_=f.y;f.x=s.x,f.y=s.y,s.x=w,s.y=_}if(s.y==h.y)R.fillFlatBottomTriangle(i,e,n,a,r,o,l);else if(f.y==s.y)R.fillFlatTopTriangle(i,e,n,a,r,o,l);else{const w=(h.x-f.x)*(s.y-f.y)/(h.y-f.y)+f.x,_=s.y;R.fillFlatBottomTriangle(f.x,f.y,s.x,s.y,w,_,l),R.fillFlatTopTriangle(s.x,s.y,w,_,h.x,h.y,l)}}static fillFlatBottomTriangle(i,e,n,a,r,o,l){const f=(n-i)/(a-e),s=(r-i)/(o-e);let h=i,w=i;for(let _=e;_<=o;_++)R.drawLine(h,_,w,_,l),h+=f,w+=s}static fillFlatTopTriangle(i,e,n,a,r,o,l){const f=(i-r)/(e-o),s=(n-r)/(a-o);let h=r,w=r;for(let _=o;_>=e;_--)R.drawLine(h,_,w,_,l),h-=f,w-=s}static drawTexel(i,e,n,a,r,o,l,f,s,h,w,_){const d=new Ot(i,e),p=new Ot(a.x,a.y),z=new Ot(r.x,r.y),E=new Ot(o.x,o.y),m=On(p,z,E,d),A=m.x,S=m.y,c=m.z;let u=l/a.w*A+s/r.w*S+w/o.w*c,y=f/a.w*A+h/r.w*S+_/o.w*c,x=1/a.w*A+1/r.w*S+1/o.w*c;u/=x,y/=x;const N=Math.abs(Math.floor(u*n.width))%n.width,T=Math.abs(Math.floor(y*n.height))%n.height;x=1-x,x<R._zBuffer[window.innerWidth*Math.floor(e)+Math.floor(i)]&&(R.drawPixel(i,e,n.data[n.width*T+N]),R._zBuffer[window.innerWidth*Math.floor(e)+Math.floor(i)]=x)}static drawRectangle(i,e,n,a,r){!R._canvasColorBufferCtx||!R._canvasView||i<0||e<0||i>=R._canvasView.width||e>=R._canvasView.height||(R._canvasColorBufferCtx.fillStyle=r,R._canvasColorBufferCtx.fillRect(i,e,n,a))}static drawPixel(i,e,n){!R._canvasColorBufferCtx||!R.canvasView||!n||i<0||e<0||i>=R.canvasView.width||e>=R.canvasView.height||(R._canvasColorBufferCtx.fillStyle=`rgba(${n.r}, ${n.g}, ${n.b}, ${n.a})`,R._canvasColorBufferCtx.fillRect(i,e,1,1))}static drawLine(i,e,n,a,r){!R._canvasColorBufferCtx||(R._canvasColorBufferCtx.beginPath(),R._canvasColorBufferCtx.moveTo(i,e),R._canvasColorBufferCtx.lineTo(n,a),R._canvasColorBufferCtx.closePath(),R._canvasColorBufferCtx.strokeStyle=r,R._canvasColorBufferCtx.stroke())}static get canvasView(){return this._canvasView}static get canvasViewCtx(){return this._canvasViewCtx}static get canvasColorBuffer(){return this._canvasColorBuffer}static get canvasColorBufferCtx(){return this._canvasColorBufferCtx}static get zBuffer(){return this._zBuffer}};let M=R;g(M,"_canvasView"),g(M,"_canvasViewCtx"),g(M,"_canvasColorBuffer"),g(M,"_canvasColorBufferCtx"),g(M,"_zBuffer");const X="wireFrameLines",H="filledTriangles",Oe="points",Le="backfaceCulling",P="textured",bt="cameraMoving",ei=class{constructor(){g(this,"_elements",{});g(this,"_renderingStates",{});g(this,"_mouseStates",{dx:0,dy:0});g(this,"_isLeftClick",!1);g(this,"_isFirstMove",!0);g(this,"_beforeX",0);g(this,"_beforeY",0);g(this,"_movementStates",{forward:!1,backward:!1,left:!1,right:!1,up:!1,down:!1});var i;this._elements[X]=document.getElementById(X),this._elements[H]=document.getElementById(H),this._elements[P]=document.getElementById(P),this._elements[Oe]=document.getElementById(Oe),this._elements[Le]=document.getElementById(Le),this._elements[bt]=document.getElementById(bt);for(const e in this._elements)this._renderingStates[e]=(i=this._elements[e])==null?void 0:i.checked}bindEvents(){var i;for(const e in this._elements)(i=this._elements[e])==null||i.addEventListener("change",()=>{this._renderingStates[e]=!this._renderingStates[e],this._renderingStates[P]&&e===P&&(this._elements[H]&&(this._elements[H].checked=!1,this._renderingStates[H]=!1),this._elements[X]&&(this._elements[X].checked=!0,this._renderingStates[X]=!0)),this._renderingStates[H]&&e===H&&(this._elements[P]&&(this._elements[P].checked=!1,this._renderingStates[P]=!1),this._elements[X]&&(this._elements[X].checked=!0,this._renderingStates[X]=!0)),this._renderingStates[bt]?(this._elements[H]&&(this._elements[H].hidden=!0,this._elements[H].checked=!1,this._renderingStates[H]=!1),this._elements[P]&&(this._elements[P].hidden=!0,this._elements[P].checked=!1,this._renderingStates[P]=!1),this._elements[X]&&(this._elements[X].checked=!0,this._renderingStates[X]=!0)):this._elements[H]&&this._elements[P]&&(this._elements[H].hidden=!1,this._elements[P].hidden=!1)});window.addEventListener("keypress",e=>{if(!!this._renderingStates[bt])switch(e.key){case"a":this._movementStates.left=!0;break;case"d":this._movementStates.right=!0;break;case"w":this._movementStates.forward=!0;break;case"s":this._movementStates.backward=!0;break;case"e":this._movementStates.up=!0;break;case"q":this._movementStates.down=!0;break}}),window.addEventListener("keyup",e=>{if(!!this._renderingStates[bt])switch(e.key){case"a":this._movementStates.left=!1;break;case"d":this._movementStates.right=!1;break;case"w":this._movementStates.forward=!1;break;case"s":this._movementStates.backward=!1;break;case"e":this._movementStates.up=!1;break;case"q":this._movementStates.down=!1;break}}),window.addEventListener("contextmenu",e=>{e.preventDefault()}),window.addEventListener("mousedown",e=>{e.buttons===2&&(this._isLeftClick=!0)}),window.addEventListener("mouseup",()=>{this._isLeftClick=!1,this._isFirstMove=!0}),window.addEventListener("mousemove",e=>{if(!this._isLeftClick||!this._renderingStates[bt])return;if(this._isFirstMove){this._beforeX=e.clientX,this._beforeY=e.clientY,this._isFirstMove=!1;return}const n=e.clientX-this._beforeX,a=this._beforeY-e.clientY;this._beforeX=e.clientX,this._beforeY=e.clientY,this.mouseStates.dx=n,this.mouseStates.dy=a})}static getInstance(){return this._instance||(this._instance=new ei),this._instance}get renderingStates(){return this._renderingStates}get movementStates(){return this._movementStates}get mouseStates(){return this._mouseStates}};let Zt=ei;g(Zt,"_instance");const Ln=16;class Lt{constructor(i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]){g(this,"_data",[]);if(i.length!=Ln)throw Error("Does not conform to the format of the matrix");this._data=i}get data(){return this._data}}class De{static identity(){return new Lt([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}static scale4x4(i,e,n){const a=new Lt;return a.data[0]=i,a.data[5]=e,a.data[10]=n,a.data[15]=1,a}static translation4x4(i,e,n){const a=this.identity();return a.data[3]=i,a.data[7]=e,a.data[11]=n,a.data[15]=1,a}static rotationX4x4(i){const e=this.identity(),n=q(i),a=Math.cos(n),r=Math.sin(n);return e.data[5]=a,e.data[6]=-r,e.data[9]=r,e.data[10]=a,e}static rotationY4x4(i){const e=this.identity(),n=q(i),a=Math.cos(n),r=Math.sin(n);return e.data[0]=a,e.data[3]=r,e.data[8]=-r,e.data[10]=a,e}static rotationZ4x4(i){const e=this.identity(),n=q(i),a=Math.cos(n),r=Math.sin(n);return e.data[0]=a,e.data[1]=-r,e.data[4]=r,e.data[5]=a,e}static projection(i,e,n,a){const r=new Lt,o=q(i);return r.data[0]=e*(1/Math.tan(o/2)),r.data[5]=1/Math.tan(o/2),r.data[10]=a/(a-n),r.data[11]=-a*n/(a-n),r.data[14]=1,r}static multiply4x4(i,e){const n=new Lt;for(let a=0;a<4;a++)for(let r=0;r<4;r++)n.data[a*4+r]=i.data[a*4+0]*e.data[0+r]+i.data[a*4+1]*e.data[4+r]+i.data[a*4+2]*e.data[8+r]+i.data[a*4+3]*e.data[12+r];return n}}class yt{constructor(i=new v,e=new v){g(this,"_point");g(this,"_normal");this._point=i,this._normal=e}get point(){return this._point}get normal(){return this._normal}set point(i){this._point=i}set normal(i){this._normal=i}}var ft=(t=>(t[t.LEFT=0]="LEFT",t[t.RIGHT=1]="RIGHT",t[t.TOP=2]="TOP",t[t.BOTTOM=3]="BOTTOM",t[t.NEAR=4]="NEAR",t[t.FAR=5]="FAR",t))(ft||{});class Dn{constructor(i,e,n,a){g(this,"_planes",[]);g(this,"_origin",new v(0,0,0));console.log(i,e);const r=Math.cos(q(i)/2),o=Math.sin(q(i)/2),l=Math.cos(q(e)/2),f=Math.sin(q(e)/2);this._planes[0]=new yt(this._origin,new v(r,0,o)),this._planes[1]=new yt(this._origin,new v(-r,0,o)),this._planes[2]=new yt(this._origin,new v(0,-l,f)),this._planes[3]=new yt(this._origin,new v(0,l,f)),this._planes[4]=new yt(new v(0,0,n),new v(0,0,1)),this._planes[5]=new yt(new v(0,0,a),new v(0,0,-1))}get planes(){return this._planes}}const ii=class{constructor(i,e,n,a,r,o){g(this,"_position");g(this,"_direction",new v(0,0,1));g(this,"_yaw",90);g(this,"_pitch",0);g(this,"_speed",2);g(this,"_forward",new v);g(this,"_right",new v);g(this,"_up",new v);g(this,"_projection");g(this,"_frustum");this._position=i,this._projection=De.projection(n,a,r,o),this._frustum=new Dn(e,n,r,o)}static addCamera(i,e,n,a,r,o){const l=new ii(i,e,n,a,r,o);this._lists.push(l)}static getCameras(){return this._lists}get position(){return this._position}get direction(){return this._direction}get projection(){return this._projection}get frustum(){return this._frustum}set position(i){this._position=i}set direction(i){this._direction=i}update(i,e,n){this._yaw+=e.dx*.1,this._pitch+=e.dy*.1,this._pitch<-89?this._pitch=-89:this._pitch>89&&(this._pitch=89);const a=q(this._yaw),r=q(this._pitch);this._direction.x=-Math.cos(a)*Math.cos(r),this._direction.y=Math.sin(r),this._direction.z=Math.sin(a)*Math.cos(r),this._direction=b.normalizeVec3(this.direction),i.forward&&(this._position=b.addVec3(this._position,b.multiplyScalar(this._forward,-this._speed*n))),i.backward&&(this._position=b.addVec3(this._position,b.multiplyScalar(this._forward,this._speed*n))),i.right&&(this._position=b.addVec3(this._position,b.multiplyScalar(this._right,this._speed*n))),i.left&&(this._position=b.addVec3(this._position,b.multiplyScalar(this._right,-this._speed*n))),i.up&&(this._position=b.addVec3(this._position,b.multiplyScalar(this._up,this._speed*n))),i.down&&(this._position=b.addVec3(this._position,b.multiplyScalar(this._up,-this._speed*n)))}getViewMatrix(){const i=new v(0,1,0);return this.lookAt(this._position,b.addVec3(this._position,this.direction),i)}lookAt(i,e,n){const a=b.normalizeVec3(b.subtractVec3(e,i)),r=b.normalizeVec3(b.crossVec3(n,a)),o=b.crossVec3(a,r);this._forward=b.multiplyScalar(a,-1),this._right=r,this._up=o;const l=-b.dotVec3(r,i),f=-b.dotVec3(o,i),s=-b.dotVec3(a,i);return new Lt([r.x,r.y,r.z,l,o.x,o.y,o.z,f,a.x,a.y,a.z,s,0,0,0,1])}};let kt=ii;g(kt,"_lists",[]);var In=function(){function t(i,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(i,a.key,a)}}return function(i,e,n){return e&&t(i.prototype,e),n&&t(i,n),i}}();function Vn(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}var Zn=function(){function t(i,e){Vn(this,t),this._reset(),this.fileContents=i,this.defaultModelName=e||"untitled"}return In(t,[{key:"_reset",value:function(){this.result={models:[],materialLibraries:[]},this.currentMaterial="",this.currentGroup="",this.smoothingGroup=0}},{key:"parse",value:function(){this._reset();for(var e=function(f){var s=f.indexOf("#");return s>-1?f.substring(0,s):f},n=this.fileContents.split(`
`),a=0;a<n.length;a+=1){var r=e(n[a]),o=r.replace(/\s\s+/g," ").trim().split(" ");switch(o[0].toLowerCase()){case"o":this._parseObject(o);break;case"g":this._parseGroup(o);break;case"v":this._parseVertexCoords(o);break;case"vt":this._parseTextureCoords(o);break;case"vn":this._parseVertexNormal(o);break;case"s":this._parseSmoothShadingStatement(o);break;case"f":this._parsePolygon(o);break;case"mtllib":this._parseMtlLib(o);break;case"usemtl":this._parseUseMtl(o);break}}return this.result}},{key:"_currentModel",value:function(){return this.result.models.length==0&&(this.result.models.push({name:this.defaultModelName,vertices:[],textureCoords:[],vertexNormals:[],faces:[]}),this.currentGroup="",this.smoothingGroup=0),this.result.models[this.result.models.length-1]}},{key:"_parseObject",value:function(e){var n=e.length>=2?e[1]:this.defaultModelName;this.result.models.push({name:n,vertices:[],textureCoords:[],vertexNormals:[],faces:[]}),this.currentGroup="",this.smoothingGroup=0}},{key:"_parseGroup",value:function(e){if(e.length!=2)throw"Group statements must have exactly 1 argument (eg. g group_1)";this.currentGroup=e[1]}},{key:"_parseVertexCoords",value:function(e){var n=e.length>=2?parseFloat(e[1]):0,a=e.length>=3?parseFloat(e[2]):0,r=e.length>=4?parseFloat(e[3]):0;this._currentModel().vertices.push({x:n,y:a,z:r})}},{key:"_parseTextureCoords",value:function(e){var n=e.length>=2?parseFloat(e[1]):0,a=e.length>=3?parseFloat(e[2]):0,r=e.length>=4?parseFloat(e[3]):0;this._currentModel().textureCoords.push({u:n,v:a,w:r})}},{key:"_parseVertexNormal",value:function(e){var n=e.length>=2?parseFloat(e[1]):0,a=e.length>=3?parseFloat(e[2]):0,r=e.length>=4?parseFloat(e[3]):0;this._currentModel().vertexNormals.push({x:n,y:a,z:r})}},{key:"_parsePolygon",value:function(e){var n=e.length-1;if(n<3)throw"Face statement has less than 3 vertices"+this.filePath+this.lineNumber;for(var a={material:this.currentMaterial,group:this.currentGroup,smoothingGroup:this.smoothingGroup,vertices:[]},r=0;r<n;r+=1){var o=e[r+1],l=o.split("/");if(l.length<1||l.length>3)throw"Two many values (separated by /) for a single vertex"+this.filePath+this.lineNumber;var f=0,s=0,h=0;if(f=parseInt(l[0]),l.length>1&&!l[1]==""&&(s=parseInt(l[1])),l.length>2&&(h=parseInt(l[2])),f==0)throw"Faces uses invalid vertex index of 0";f<0&&(f=this._currentModel().vertices.length+1+f),a.vertices.push({vertexIndex:f,textureCoordsIndex:s,vertexNormalIndex:h})}this._currentModel().faces.push(a)}},{key:"_parseMtlLib",value:function(e){e.length>=2&&this.result.materialLibraries.push(e[1])}},{key:"_parseUseMtl",value:function(e){e.length>=2&&(this.currentMaterial=e[1])}},{key:"_parseSmoothShadingStatement",value:function(e){if(e.length!=2)throw"Smoothing group statements must have exactly 1 argument (eg. s <number|off>)";var n=e[1].toLowerCase()=="off"?0:parseInt(e[1]);this.smoothingGroup=n}}]),t}(),Fn=Zn;class $n{constructor(i){g(this,"_faces",[]);g(this,"_vertices",[]);g(this,"_filePath");this._filePath=i}get vertices(){return this._vertices}get faces(){return this._faces}async load(){const e=await(await fetch(this._filePath)).text(),a=new Fn(e).parse();this._vertices=a.models[0].vertices.map(o=>new v(o.x,o.y,o.z));const r=a.models[0].textureCoords;return this._faces=a.models[0].faces.map(o=>({a:o.vertices[0].vertexIndex-1,b:o.vertices[1].vertexIndex-1,c:o.vertices[2].vertexIndex-1,uvA:r[Math.abs(o.vertices[0].textureCoordsIndex)-1],uvB:r[Math.abs(o.vertices[1].textureCoordsIndex)-1],uvC:r[Math.abs(o.vertices[2].textureCoordsIndex)-1]})),this}}(function(t){if(t.TextEncoder&&t.TextDecoder)return!1;function i(n="utf-8"){if(n!=="utf-8")throw new RangeError(`Failed to construct 'TextEncoder': The encoding label provided ('${n}') is invalid.`)}Object.defineProperty(i.prototype,"encoding",{value:"utf-8"}),i.prototype.encode=function(n,a={stream:!1}){if(a.stream)throw new Error("Failed to encode: the 'stream' option is unsupported.");let r=0;const o=n.length;let l=0,f=Math.max(32,o+(o>>1)+7),s=new Uint8Array(f>>3<<3);for(;r<o;){let h=n.charCodeAt(r++);if(h>=55296&&h<=56319){if(r<o){const w=n.charCodeAt(r);(w&64512)===56320&&(++r,h=((h&1023)<<10)+(w&1023)+65536)}if(h>=55296&&h<=56319)continue}if(l+4>s.length){f+=8,f*=1+r/n.length*2,f=f>>3<<3;const w=new Uint8Array(f);w.set(s),s=w}if((h&4294967168)===0){s[l++]=h;continue}else if((h&4294965248)===0)s[l++]=h>>6&31|192;else if((h&4294901760)===0)s[l++]=h>>12&15|224,s[l++]=h>>6&63|128;else if((h&4292870144)===0)s[l++]=h>>18&7|240,s[l++]=h>>12&63|128,s[l++]=h>>6&63|128;else continue;s[l++]=h&63|128}return s.slice(0,l)};function e(n="utf-8",a={fatal:!1}){if(n!=="utf-8")throw new RangeError(`Failed to construct 'TextDecoder': The encoding label provided ('${n}') is invalid.`);if(a.fatal)throw new Error("Failed to construct 'TextDecoder': the 'fatal' option is unsupported.")}Object.defineProperty(e.prototype,"encoding",{value:"utf-8"}),Object.defineProperty(e.prototype,"fatal",{value:!1}),Object.defineProperty(e.prototype,"ignoreBOM",{value:!1}),e.prototype.decode=function(n,a={stream:!1}){if(a.stream)throw new Error("Failed to decode: the 'stream' option is unsupported.");const r=new Uint8Array(n);let o=0;const l=r.length,f=[];for(;o<l;){const s=r[o++];if(s===0)break;if((s&128)===0)f.push(s);else if((s&224)===192){const h=r[o++]&63;f.push((s&31)<<6|h)}else if((s&240)===224){const h=r[o++]&63,w=r[o++]&63;f.push((s&31)<<12|h<<6|w)}else if((s&248)===240){const h=r[o++]&63,w=r[o++]&63,_=r[o++]&63;let d=(s&7)<<18|h<<12|w<<6|_;d>65535&&(d-=65536,f.push(d>>>10&1023|55296),d=56320|d&1023),f.push(d)}}return String.fromCharCode.apply(null,f)},t.TextEncoder=i,t.TextDecoder=e})(typeof window<"u"?window:typeof self<"u"?self:globalThis);function ai(t,i="utf8"){return new TextDecoder(i).decode(t)}const Hn=new TextEncoder;function Pn(t){return Hn.encode(t)}const Wn=1024*8,jn=(()=>{const t=new Uint8Array(4),i=new Uint32Array(t.buffer);return!((i[0]=1)&t[0])})(),be={int8:Int8Array,uint8:Uint8Array,int16:Int16Array,uint16:Uint16Array,int32:Int32Array,uint32:Uint32Array,uint64:BigUint64Array,int64:BigInt64Array,float32:Float32Array,float64:Float64Array};class Ge{constructor(i=Wn,e={}){let n=!1;typeof i=="number"?i=new ArrayBuffer(i):(n=!0,this.lastWrittenByte=i.byteLength);const a=e.offset?e.offset>>>0:0,r=i.byteLength-a;let o=a;(ArrayBuffer.isView(i)||i instanceof Ge)&&(i.byteLength!==i.buffer.byteLength&&(o=i.byteOffset+a),i=i.buffer),n?this.lastWrittenByte=r:this.lastWrittenByte=0,this.buffer=i,this.length=r,this.byteLength=r,this.byteOffset=o,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer,o,r),this._mark=0,this._marks=[]}available(i=1){return this.offset+i<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(i=1){return this.offset+=i,this}back(i=1){return this.offset-=i,this}seek(i){return this.offset=i,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const i=this._marks.pop();if(i===void 0)throw new Error("Mark stack empty");return this.seek(i),this}rewind(){return this.offset=0,this}ensureAvailable(i=1){if(!this.available(i)){const n=(this.offset+i)*2,a=new Uint8Array(n);a.set(new Uint8Array(this.buffer)),this.buffer=a.buffer,this.length=this.byteLength=n,this._data=new DataView(this.buffer)}return this}readBoolean(){return this.readUint8()!==0}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(i=1){return this.readArray(i,"uint8")}readArray(i,e){const n=be[e].BYTES_PER_ELEMENT*i,a=this.byteOffset+this.offset,r=this.buffer.slice(a,a+n);if(this.littleEndian===jn&&e!=="uint8"&&e!=="int8"){const l=new Uint8Array(this.buffer.slice(a,a+n));l.reverse();const f=new be[e](l.buffer);return this.offset+=n,f.reverse(),f}const o=new be[e](r);return this.offset+=n,o}readInt16(){const i=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,i}readUint16(){const i=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,i}readInt32(){const i=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,i}readUint32(){const i=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,i}readFloat32(){const i=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,i}readFloat64(){const i=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,i}readBigInt64(){const i=this._data.getBigInt64(this.offset,this.littleEndian);return this.offset+=8,i}readBigUint64(){const i=this._data.getBigUint64(this.offset,this.littleEndian);return this.offset+=8,i}readChar(){return String.fromCharCode(this.readInt8())}readChars(i=1){let e="";for(let n=0;n<i;n++)e+=this.readChar();return e}readUtf8(i=1){return ai(this.readBytes(i))}decodeText(i=1,e="utf-8"){return ai(this.readBytes(i),e)}writeBoolean(i){return this.writeUint8(i?255:0),this}writeInt8(i){return this.ensureAvailable(1),this._data.setInt8(this.offset++,i),this._updateLastWrittenByte(),this}writeUint8(i){return this.ensureAvailable(1),this._data.setUint8(this.offset++,i),this._updateLastWrittenByte(),this}writeByte(i){return this.writeUint8(i)}writeBytes(i){this.ensureAvailable(i.length);for(let e=0;e<i.length;e++)this._data.setUint8(this.offset++,i[e]);return this._updateLastWrittenByte(),this}writeInt16(i){return this.ensureAvailable(2),this._data.setInt16(this.offset,i,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(i){return this.ensureAvailable(2),this._data.setUint16(this.offset,i,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(i){return this.ensureAvailable(4),this._data.setInt32(this.offset,i,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(i){return this.ensureAvailable(4),this._data.setUint32(this.offset,i,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(i){return this.ensureAvailable(4),this._data.setFloat32(this.offset,i,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(i){return this.ensureAvailable(8),this._data.setFloat64(this.offset,i,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigInt64(i){return this.ensureAvailable(8),this._data.setBigInt64(this.offset,i,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigUint64(i){return this.ensureAvailable(8),this._data.setBigUint64(this.offset,i,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(i){return this.writeUint8(i.charCodeAt(0))}writeChars(i){for(let e=0;e<i.length;e++)this.writeUint8(i.charCodeAt(e));return this}writeUtf8(i){return this.writeBytes(Pn(i))}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this.lastWrittenByte)}_updateLastWrittenByte(){this.offset>this.lastWrittenByte&&(this.lastWrittenByte=this.offset)}}/*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) */const Gn=4,ri=0,si=1,Xn=2;function Ct(t){let i=t.length;for(;--i>=0;)t[i]=0}const Yn=0,Yi=1,Kn=2,qn=3,Jn=258,Xe=29,Qt=256,Wt=Qt+1+Xe,Et=30,Ye=19,Ki=2*Wt+1,dt=15,ye=16,Qn=7,Ke=256,qi=16,Ji=17,Qi=18,Ie=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),he=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),ta=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),tn=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),ea=512,nt=new Array((Wt+2)*2);Ct(nt);const Ft=new Array(Et*2);Ct(Ft);const jt=new Array(ea);Ct(jt);const Gt=new Array(Jn-qn+1);Ct(Gt);const qe=new Array(Xe);Ct(qe);const ce=new Array(Et);Ct(ce);function ve(t,i,e,n,a){this.static_tree=t,this.extra_bits=i,this.extra_base=e,this.elems=n,this.max_length=a,this.has_stree=t&&t.length}let en,nn,an;function me(t,i){this.dyn_tree=t,this.max_code=0,this.stat_desc=i}const rn=t=>t<256?jt[t]:jt[256+(t>>>7)],Xt=(t,i)=>{t.pending_buf[t.pending++]=i&255,t.pending_buf[t.pending++]=i>>>8&255},W=(t,i,e)=>{t.bi_valid>ye-e?(t.bi_buf|=i<<t.bi_valid&65535,Xt(t,t.bi_buf),t.bi_buf=i>>ye-t.bi_valid,t.bi_valid+=e-ye):(t.bi_buf|=i<<t.bi_valid&65535,t.bi_valid+=e)},Q=(t,i,e)=>{W(t,e[i*2],e[i*2+1])},sn=(t,i)=>{let e=0;do e|=t&1,t>>>=1,e<<=1;while(--i>0);return e>>>1},ia=t=>{t.bi_valid===16?(Xt(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=t.bi_buf&255,t.bi_buf>>=8,t.bi_valid-=8)},na=(t,i)=>{const e=i.dyn_tree,n=i.max_code,a=i.stat_desc.static_tree,r=i.stat_desc.has_stree,o=i.stat_desc.extra_bits,l=i.stat_desc.extra_base,f=i.stat_desc.max_length;let s,h,w,_,d,p,z=0;for(_=0;_<=dt;_++)t.bl_count[_]=0;for(e[t.heap[t.heap_max]*2+1]=0,s=t.heap_max+1;s<Ki;s++)h=t.heap[s],_=e[e[h*2+1]*2+1]+1,_>f&&(_=f,z++),e[h*2+1]=_,!(h>n)&&(t.bl_count[_]++,d=0,h>=l&&(d=o[h-l]),p=e[h*2],t.opt_len+=p*(_+d),r&&(t.static_len+=p*(a[h*2+1]+d)));if(z!==0){do{for(_=f-1;t.bl_count[_]===0;)_--;t.bl_count[_]--,t.bl_count[_+1]+=2,t.bl_count[f]--,z-=2}while(z>0);for(_=f;_!==0;_--)for(h=t.bl_count[_];h!==0;)w=t.heap[--s],!(w>n)&&(e[w*2+1]!==_&&(t.opt_len+=(_-e[w*2+1])*e[w*2],e[w*2+1]=_),h--)}},on=(t,i,e)=>{const n=new Array(dt+1);let a=0,r,o;for(r=1;r<=dt;r++)a=a+e[r-1]<<1,n[r]=a;for(o=0;o<=i;o++){let l=t[o*2+1];l!==0&&(t[o*2]=sn(n[l]++,l))}},aa=()=>{let t,i,e,n,a;const r=new Array(dt+1);for(e=0,n=0;n<Xe-1;n++)for(qe[n]=e,t=0;t<1<<Ie[n];t++)Gt[e++]=n;for(Gt[e-1]=n,a=0,n=0;n<16;n++)for(ce[n]=a,t=0;t<1<<he[n];t++)jt[a++]=n;for(a>>=7;n<Et;n++)for(ce[n]=a<<7,t=0;t<1<<he[n]-7;t++)jt[256+a++]=n;for(i=0;i<=dt;i++)r[i]=0;for(t=0;t<=143;)nt[t*2+1]=8,t++,r[8]++;for(;t<=255;)nt[t*2+1]=9,t++,r[9]++;for(;t<=279;)nt[t*2+1]=7,t++,r[7]++;for(;t<=287;)nt[t*2+1]=8,t++,r[8]++;for(on(nt,Wt+1,r),t=0;t<Et;t++)Ft[t*2+1]=5,Ft[t*2]=sn(t,5);en=new ve(nt,Ie,Qt+1,Wt,dt),nn=new ve(Ft,he,0,Et,dt),an=new ve(new Array(0),ta,0,Ye,Qn)},ln=t=>{let i;for(i=0;i<Wt;i++)t.dyn_ltree[i*2]=0;for(i=0;i<Et;i++)t.dyn_dtree[i*2]=0;for(i=0;i<Ye;i++)t.bl_tree[i*2]=0;t.dyn_ltree[Ke*2]=1,t.opt_len=t.static_len=0,t.sym_next=t.matches=0},hn=t=>{t.bi_valid>8?Xt(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},oi=(t,i,e,n)=>{const a=i*2,r=e*2;return t[a]<t[r]||t[a]===t[r]&&n[i]<=n[e]},ke=(t,i,e)=>{const n=t.heap[e];let a=e<<1;for(;a<=t.heap_len&&(a<t.heap_len&&oi(i,t.heap[a+1],t.heap[a],t.depth)&&a++,!oi(i,n,t.heap[a],t.depth));)t.heap[e]=t.heap[a],e=a,a<<=1;t.heap[e]=n},li=(t,i,e)=>{let n,a,r=0,o,l;if(t.sym_next!==0)do n=t.pending_buf[t.sym_buf+r++]&255,n+=(t.pending_buf[t.sym_buf+r++]&255)<<8,a=t.pending_buf[t.sym_buf+r++],n===0?Q(t,a,i):(o=Gt[a],Q(t,o+Qt+1,i),l=Ie[o],l!==0&&(a-=qe[o],W(t,a,l)),n--,o=rn(n),Q(t,o,e),l=he[o],l!==0&&(n-=ce[o],W(t,n,l)));while(r<t.sym_next);Q(t,Ke,i)},Ve=(t,i)=>{const e=i.dyn_tree,n=i.stat_desc.static_tree,a=i.stat_desc.has_stree,r=i.stat_desc.elems;let o,l,f=-1,s;for(t.heap_len=0,t.heap_max=Ki,o=0;o<r;o++)e[o*2]!==0?(t.heap[++t.heap_len]=f=o,t.depth[o]=0):e[o*2+1]=0;for(;t.heap_len<2;)s=t.heap[++t.heap_len]=f<2?++f:0,e[s*2]=1,t.depth[s]=0,t.opt_len--,a&&(t.static_len-=n[s*2+1]);for(i.max_code=f,o=t.heap_len>>1;o>=1;o--)ke(t,e,o);s=r;do o=t.heap[1],t.heap[1]=t.heap[t.heap_len--],ke(t,e,1),l=t.heap[1],t.heap[--t.heap_max]=o,t.heap[--t.heap_max]=l,e[s*2]=e[o*2]+e[l*2],t.depth[s]=(t.depth[o]>=t.depth[l]?t.depth[o]:t.depth[l])+1,e[o*2+1]=e[l*2+1]=s,t.heap[1]=s++,ke(t,e,1);while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],na(t,i),on(e,f,t.bl_count)},hi=(t,i,e)=>{let n,a=-1,r,o=i[0*2+1],l=0,f=7,s=4;for(o===0&&(f=138,s=3),i[(e+1)*2+1]=65535,n=0;n<=e;n++)r=o,o=i[(n+1)*2+1],!(++l<f&&r===o)&&(l<s?t.bl_tree[r*2]+=l:r!==0?(r!==a&&t.bl_tree[r*2]++,t.bl_tree[qi*2]++):l<=10?t.bl_tree[Ji*2]++:t.bl_tree[Qi*2]++,l=0,a=r,o===0?(f=138,s=3):r===o?(f=6,s=3):(f=7,s=4))},fi=(t,i,e)=>{let n,a=-1,r,o=i[0*2+1],l=0,f=7,s=4;for(o===0&&(f=138,s=3),n=0;n<=e;n++)if(r=o,o=i[(n+1)*2+1],!(++l<f&&r===o)){if(l<s)do Q(t,r,t.bl_tree);while(--l!==0);else r!==0?(r!==a&&(Q(t,r,t.bl_tree),l--),Q(t,qi,t.bl_tree),W(t,l-3,2)):l<=10?(Q(t,Ji,t.bl_tree),W(t,l-3,3)):(Q(t,Qi,t.bl_tree),W(t,l-11,7));l=0,a=r,o===0?(f=138,s=3):r===o?(f=6,s=3):(f=7,s=4)}},ra=t=>{let i;for(hi(t,t.dyn_ltree,t.l_desc.max_code),hi(t,t.dyn_dtree,t.d_desc.max_code),Ve(t,t.bl_desc),i=Ye-1;i>=3&&t.bl_tree[tn[i]*2+1]===0;i--);return t.opt_len+=3*(i+1)+5+5+4,i},sa=(t,i,e,n)=>{let a;for(W(t,i-257,5),W(t,e-1,5),W(t,n-4,4),a=0;a<n;a++)W(t,t.bl_tree[tn[a]*2+1],3);fi(t,t.dyn_ltree,i-1),fi(t,t.dyn_dtree,e-1)},oa=t=>{let i=4093624447,e;for(e=0;e<=31;e++,i>>>=1)if(i&1&&t.dyn_ltree[e*2]!==0)return ri;if(t.dyn_ltree[9*2]!==0||t.dyn_ltree[10*2]!==0||t.dyn_ltree[13*2]!==0)return si;for(e=32;e<Qt;e++)if(t.dyn_ltree[e*2]!==0)return si;return ri};let ci=!1;const la=t=>{ci||(aa(),ci=!0),t.l_desc=new me(t.dyn_ltree,en),t.d_desc=new me(t.dyn_dtree,nn),t.bl_desc=new me(t.bl_tree,an),t.bi_buf=0,t.bi_valid=0,ln(t)},fn=(t,i,e,n)=>{W(t,(Yn<<1)+(n?1:0),3),hn(t),Xt(t,e),Xt(t,~e),e&&t.pending_buf.set(t.window.subarray(i,i+e),t.pending),t.pending+=e},ha=t=>{W(t,Yi<<1,3),Q(t,Ke,nt),ia(t)},fa=(t,i,e,n)=>{let a,r,o=0;t.level>0?(t.strm.data_type===Xn&&(t.strm.data_type=oa(t)),Ve(t,t.l_desc),Ve(t,t.d_desc),o=ra(t),a=t.opt_len+3+7>>>3,r=t.static_len+3+7>>>3,r<=a&&(a=r)):a=r=e+5,e+4<=a&&i!==-1?fn(t,i,e,n):t.strategy===Gn||r===a?(W(t,(Yi<<1)+(n?1:0),3),li(t,nt,Ft)):(W(t,(Kn<<1)+(n?1:0),3),sa(t,t.l_desc.max_code+1,t.d_desc.max_code+1,o+1),li(t,t.dyn_ltree,t.dyn_dtree)),ln(t),n&&hn(t)},ca=(t,i,e)=>(t.pending_buf[t.sym_buf+t.sym_next++]=i,t.pending_buf[t.sym_buf+t.sym_next++]=i>>8,t.pending_buf[t.sym_buf+t.sym_next++]=e,i===0?t.dyn_ltree[e*2]++:(t.matches++,i--,t.dyn_ltree[(Gt[e]+Qt+1)*2]++,t.dyn_dtree[rn(i)*2]++),t.sym_next===t.sym_end);var da=la,_a=fn,ua=fa,wa=ca,pa=ha,ga={_tr_init:da,_tr_stored_block:_a,_tr_flush_block:ua,_tr_tally:wa,_tr_align:pa};const xa=(t,i,e,n)=>{let a=t&65535|0,r=t>>>16&65535|0,o=0;for(;e!==0;){o=e>2e3?2e3:e,e-=o;do a=a+i[n++]|0,r=r+a|0;while(--o);a%=65521,r%=65521}return a|r<<16|0};var Yt=xa;const ba=()=>{let t,i=[];for(var e=0;e<256;e++){t=e;for(var n=0;n<8;n++)t=t&1?3988292384^t>>>1:t>>>1;i[e]=t}return i},ya=new Uint32Array(ba()),va=(t,i,e,n)=>{const a=ya,r=n+e;t^=-1;for(let o=n;o<r;o++)t=t>>>8^a[(t^i[o])&255];return t^-1};var Z=va,At={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},te={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:ma,_tr_stored_block:Ze,_tr_flush_block:ka,_tr_tally:ot,_tr_align:Ea}=ga,{Z_NO_FLUSH:lt,Z_PARTIAL_FLUSH:Aa,Z_FULL_FLUSH:za,Z_FINISH:Y,Z_BLOCK:di,Z_OK:F,Z_STREAM_END:_i,Z_STREAM_ERROR:tt,Z_DATA_ERROR:Sa,Z_BUF_ERROR:Ee,Z_DEFAULT_COMPRESSION:Ca,Z_FILTERED:Ta,Z_HUFFMAN_ONLY:ne,Z_RLE:Ra,Z_FIXED:Ua,Z_DEFAULT_STRATEGY:Ma,Z_UNKNOWN:Na,Z_DEFLATED:pe}=te,Ba=9,Oa=15,La=8,Da=29,Ia=256,Fe=Ia+1+Da,Va=30,Za=19,Fa=2*Fe+1,$a=15,U=3,st=258,et=st+U+1,Ha=32,zt=42,Je=57,$e=69,He=73,Pe=91,We=103,_t=113,Dt=666,$=1,Tt=2,pt=3,Rt=4,Pa=3,ut=(t,i)=>(t.msg=At[i],i),ui=t=>t*2-(t>4?9:0),rt=t=>{let i=t.length;for(;--i>=0;)t[i]=0},Wa=t=>{let i,e,n,a=t.w_size;i=t.hash_size,n=i;do e=t.head[--n],t.head[n]=e>=a?e-a:0;while(--i);i=a,n=i;do e=t.prev[--n],t.prev[n]=e>=a?e-a:0;while(--i)};let ja=(t,i,e)=>(i<<t.hash_shift^e)&t.hash_mask,ht=ja;const j=t=>{const i=t.state;let e=i.pending;e>t.avail_out&&(e=t.avail_out),e!==0&&(t.output.set(i.pending_buf.subarray(i.pending_out,i.pending_out+e),t.next_out),t.next_out+=e,i.pending_out+=e,t.total_out+=e,t.avail_out-=e,i.pending-=e,i.pending===0&&(i.pending_out=0))},G=(t,i)=>{ka(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,i),t.block_start=t.strstart,j(t.strm)},B=(t,i)=>{t.pending_buf[t.pending++]=i},Bt=(t,i)=>{t.pending_buf[t.pending++]=i>>>8&255,t.pending_buf[t.pending++]=i&255},je=(t,i,e,n)=>{let a=t.avail_in;return a>n&&(a=n),a===0?0:(t.avail_in-=a,i.set(t.input.subarray(t.next_in,t.next_in+a),e),t.state.wrap===1?t.adler=Yt(t.adler,i,a,e):t.state.wrap===2&&(t.adler=Z(t.adler,i,a,e)),t.next_in+=a,t.total_in+=a,a)},cn=(t,i)=>{let e=t.max_chain_length,n=t.strstart,a,r,o=t.prev_length,l=t.nice_match;const f=t.strstart>t.w_size-et?t.strstart-(t.w_size-et):0,s=t.window,h=t.w_mask,w=t.prev,_=t.strstart+st;let d=s[n+o-1],p=s[n+o];t.prev_length>=t.good_match&&(e>>=2),l>t.lookahead&&(l=t.lookahead);do if(a=i,!(s[a+o]!==p||s[a+o-1]!==d||s[a]!==s[n]||s[++a]!==s[n+1])){n+=2,a++;do;while(s[++n]===s[++a]&&s[++n]===s[++a]&&s[++n]===s[++a]&&s[++n]===s[++a]&&s[++n]===s[++a]&&s[++n]===s[++a]&&s[++n]===s[++a]&&s[++n]===s[++a]&&n<_);if(r=st-(_-n),n=_-st,r>o){if(t.match_start=i,o=r,r>=l)break;d=s[n+o-1],p=s[n+o]}}while((i=w[i&h])>f&&--e!==0);return o<=t.lookahead?o:t.lookahead},St=t=>{const i=t.w_size;let e,n,a;do{if(n=t.window_size-t.lookahead-t.strstart,t.strstart>=i+(i-et)&&(t.window.set(t.window.subarray(i,i+i-n),0),t.match_start-=i,t.strstart-=i,t.block_start-=i,t.insert>t.strstart&&(t.insert=t.strstart),Wa(t),n+=i),t.strm.avail_in===0)break;if(e=je(t.strm,t.window,t.strstart+t.lookahead,n),t.lookahead+=e,t.lookahead+t.insert>=U)for(a=t.strstart-t.insert,t.ins_h=t.window[a],t.ins_h=ht(t,t.ins_h,t.window[a+1]);t.insert&&(t.ins_h=ht(t,t.ins_h,t.window[a+U-1]),t.prev[a&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=a,a++,t.insert--,!(t.lookahead+t.insert<U)););}while(t.lookahead<et&&t.strm.avail_in!==0)},dn=(t,i)=>{let e=t.pending_buf_size-5>t.w_size?t.w_size:t.pending_buf_size-5,n,a,r,o=0,l=t.strm.avail_in;do{if(n=65535,r=t.bi_valid+42>>3,t.strm.avail_out<r||(r=t.strm.avail_out-r,a=t.strstart-t.block_start,n>a+t.strm.avail_in&&(n=a+t.strm.avail_in),n>r&&(n=r),n<e&&(n===0&&i!==Y||i===lt||n!==a+t.strm.avail_in)))break;o=i===Y&&n===a+t.strm.avail_in?1:0,Ze(t,0,0,o),t.pending_buf[t.pending-4]=n,t.pending_buf[t.pending-3]=n>>8,t.pending_buf[t.pending-2]=~n,t.pending_buf[t.pending-1]=~n>>8,j(t.strm),a&&(a>n&&(a=n),t.strm.output.set(t.window.subarray(t.block_start,t.block_start+a),t.strm.next_out),t.strm.next_out+=a,t.strm.avail_out-=a,t.strm.total_out+=a,t.block_start+=a,n-=a),n&&(je(t.strm,t.strm.output,t.strm.next_out,n),t.strm.next_out+=n,t.strm.avail_out-=n,t.strm.total_out+=n)}while(o===0);return l-=t.strm.avail_in,l&&(l>=t.w_size?(t.matches=2,t.window.set(t.strm.input.subarray(t.strm.next_in-t.w_size,t.strm.next_in),0),t.strstart=t.w_size,t.insert=t.strstart):(t.window_size-t.strstart<=l&&(t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,t.insert>t.strstart&&(t.insert=t.strstart)),t.window.set(t.strm.input.subarray(t.strm.next_in-l,t.strm.next_in),t.strstart),t.strstart+=l,t.insert+=l>t.w_size-t.insert?t.w_size-t.insert:l),t.block_start=t.strstart),t.high_water<t.strstart&&(t.high_water=t.strstart),o?Rt:i!==lt&&i!==Y&&t.strm.avail_in===0&&t.strstart===t.block_start?Tt:(r=t.window_size-t.strstart,t.strm.avail_in>r&&t.block_start>=t.w_size&&(t.block_start-=t.w_size,t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,r+=t.w_size,t.insert>t.strstart&&(t.insert=t.strstart)),r>t.strm.avail_in&&(r=t.strm.avail_in),r&&(je(t.strm,t.window,t.strstart,r),t.strstart+=r,t.insert+=r>t.w_size-t.insert?t.w_size-t.insert:r),t.high_water<t.strstart&&(t.high_water=t.strstart),r=t.bi_valid+42>>3,r=t.pending_buf_size-r>65535?65535:t.pending_buf_size-r,e=r>t.w_size?t.w_size:r,a=t.strstart-t.block_start,(a>=e||(a||i===Y)&&i!==lt&&t.strm.avail_in===0&&a<=r)&&(n=a>r?r:a,o=i===Y&&t.strm.avail_in===0&&n===a?1:0,Ze(t,t.block_start,n,o),t.block_start+=n,j(t.strm)),o?pt:$)},Ae=(t,i)=>{let e,n;for(;;){if(t.lookahead<et){if(St(t),t.lookahead<et&&i===lt)return $;if(t.lookahead===0)break}if(e=0,t.lookahead>=U&&(t.ins_h=ht(t,t.ins_h,t.window[t.strstart+U-1]),e=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),e!==0&&t.strstart-e<=t.w_size-et&&(t.match_length=cn(t,e)),t.match_length>=U)if(n=ot(t,t.strstart-t.match_start,t.match_length-U),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=U){t.match_length--;do t.strstart++,t.ins_h=ht(t,t.ins_h,t.window[t.strstart+U-1]),e=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart;while(--t.match_length!==0);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=ht(t,t.ins_h,t.window[t.strstart+1]);else n=ot(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(n&&(G(t,!1),t.strm.avail_out===0))return $}return t.insert=t.strstart<U-1?t.strstart:U-1,i===Y?(G(t,!0),t.strm.avail_out===0?pt:Rt):t.sym_next&&(G(t,!1),t.strm.avail_out===0)?$:Tt},vt=(t,i)=>{let e,n,a;for(;;){if(t.lookahead<et){if(St(t),t.lookahead<et&&i===lt)return $;if(t.lookahead===0)break}if(e=0,t.lookahead>=U&&(t.ins_h=ht(t,t.ins_h,t.window[t.strstart+U-1]),e=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=U-1,e!==0&&t.prev_length<t.max_lazy_match&&t.strstart-e<=t.w_size-et&&(t.match_length=cn(t,e),t.match_length<=5&&(t.strategy===Ta||t.match_length===U&&t.strstart-t.match_start>4096)&&(t.match_length=U-1)),t.prev_length>=U&&t.match_length<=t.prev_length){a=t.strstart+t.lookahead-U,n=ot(t,t.strstart-1-t.prev_match,t.prev_length-U),t.lookahead-=t.prev_length-1,t.prev_length-=2;do++t.strstart<=a&&(t.ins_h=ht(t,t.ins_h,t.window[t.strstart+U-1]),e=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart);while(--t.prev_length!==0);if(t.match_available=0,t.match_length=U-1,t.strstart++,n&&(G(t,!1),t.strm.avail_out===0))return $}else if(t.match_available){if(n=ot(t,0,t.window[t.strstart-1]),n&&G(t,!1),t.strstart++,t.lookahead--,t.strm.avail_out===0)return $}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(n=ot(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<U-1?t.strstart:U-1,i===Y?(G(t,!0),t.strm.avail_out===0?pt:Rt):t.sym_next&&(G(t,!1),t.strm.avail_out===0)?$:Tt},Ga=(t,i)=>{let e,n,a,r;const o=t.window;for(;;){if(t.lookahead<=st){if(St(t),t.lookahead<=st&&i===lt)return $;if(t.lookahead===0)break}if(t.match_length=0,t.lookahead>=U&&t.strstart>0&&(a=t.strstart-1,n=o[a],n===o[++a]&&n===o[++a]&&n===o[++a])){r=t.strstart+st;do;while(n===o[++a]&&n===o[++a]&&n===o[++a]&&n===o[++a]&&n===o[++a]&&n===o[++a]&&n===o[++a]&&n===o[++a]&&a<r);t.match_length=st-(r-a),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=U?(e=ot(t,1,t.match_length-U),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(e=ot(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),e&&(G(t,!1),t.strm.avail_out===0))return $}return t.insert=0,i===Y?(G(t,!0),t.strm.avail_out===0?pt:Rt):t.sym_next&&(G(t,!1),t.strm.avail_out===0)?$:Tt},Xa=(t,i)=>{let e;for(;;){if(t.lookahead===0&&(St(t),t.lookahead===0)){if(i===lt)return $;break}if(t.match_length=0,e=ot(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,e&&(G(t,!1),t.strm.avail_out===0))return $}return t.insert=0,i===Y?(G(t,!0),t.strm.avail_out===0?pt:Rt):t.sym_next&&(G(t,!1),t.strm.avail_out===0)?$:Tt};function J(t,i,e,n,a){this.good_length=t,this.max_lazy=i,this.nice_length=e,this.max_chain=n,this.func=a}const It=[new J(0,0,0,0,dn),new J(4,4,8,4,Ae),new J(4,5,16,8,Ae),new J(4,6,32,32,Ae),new J(4,4,16,16,vt),new J(8,16,32,32,vt),new J(8,16,128,128,vt),new J(8,32,128,256,vt),new J(32,128,258,1024,vt),new J(32,258,258,4096,vt)],Ya=t=>{t.window_size=2*t.w_size,rt(t.head),t.max_lazy_match=It[t.level].max_lazy,t.good_match=It[t.level].good_length,t.nice_match=It[t.level].nice_length,t.max_chain_length=It[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=U-1,t.match_available=0,t.ins_h=0};function Ka(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=pe,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(Fa*2),this.dyn_dtree=new Uint16Array((2*Va+1)*2),this.bl_tree=new Uint16Array((2*Za+1)*2),rt(this.dyn_ltree),rt(this.dyn_dtree),rt(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array($a+1),this.heap=new Uint16Array(2*Fe+1),rt(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*Fe+1),rt(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const ee=t=>{if(!t)return 1;const i=t.state;return!i||i.strm!==t||i.status!==zt&&i.status!==Je&&i.status!==$e&&i.status!==He&&i.status!==Pe&&i.status!==We&&i.status!==_t&&i.status!==Dt?1:0},_n=t=>{if(ee(t))return ut(t,tt);t.total_in=t.total_out=0,t.data_type=Na;const i=t.state;return i.pending=0,i.pending_out=0,i.wrap<0&&(i.wrap=-i.wrap),i.status=i.wrap===2?Je:i.wrap?zt:_t,t.adler=i.wrap===2?0:1,i.last_flush=-2,ma(i),F},un=t=>{const i=_n(t);return i===F&&Ya(t.state),i},qa=(t,i)=>ee(t)||t.state.wrap!==2?tt:(t.state.gzhead=i,F),wn=(t,i,e,n,a,r)=>{if(!t)return tt;let o=1;if(i===Ca&&(i=6),n<0?(o=0,n=-n):n>15&&(o=2,n-=16),a<1||a>Ba||e!==pe||n<8||n>15||i<0||i>9||r<0||r>Ua||n===8&&o!==1)return ut(t,tt);n===8&&(n=9);const l=new Ka;return t.state=l,l.strm=t,l.status=zt,l.wrap=o,l.gzhead=null,l.w_bits=n,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=a+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+U-1)/U),l.window=new Uint8Array(l.w_size*2),l.head=new Uint16Array(l.hash_size),l.prev=new Uint16Array(l.w_size),l.lit_bufsize=1<<a+6,l.pending_buf_size=l.lit_bufsize*4,l.pending_buf=new Uint8Array(l.pending_buf_size),l.sym_buf=l.lit_bufsize,l.sym_end=(l.lit_bufsize-1)*3,l.level=i,l.strategy=r,l.method=e,un(t)},Ja=(t,i)=>wn(t,i,pe,Oa,La,Ma),Qa=(t,i)=>{if(ee(t)||i>di||i<0)return t?ut(t,tt):tt;const e=t.state;if(!t.output||t.avail_in!==0&&!t.input||e.status===Dt&&i!==Y)return ut(t,t.avail_out===0?Ee:tt);const n=e.last_flush;if(e.last_flush=i,e.pending!==0){if(j(t),t.avail_out===0)return e.last_flush=-1,F}else if(t.avail_in===0&&ui(i)<=ui(n)&&i!==Y)return ut(t,Ee);if(e.status===Dt&&t.avail_in!==0)return ut(t,Ee);if(e.status===zt&&e.wrap===0&&(e.status=_t),e.status===zt){let a=pe+(e.w_bits-8<<4)<<8,r=-1;if(e.strategy>=ne||e.level<2?r=0:e.level<6?r=1:e.level===6?r=2:r=3,a|=r<<6,e.strstart!==0&&(a|=Ha),a+=31-a%31,Bt(e,a),e.strstart!==0&&(Bt(e,t.adler>>>16),Bt(e,t.adler&65535)),t.adler=1,e.status=_t,j(t),e.pending!==0)return e.last_flush=-1,F}if(e.status===Je){if(t.adler=0,B(e,31),B(e,139),B(e,8),e.gzhead)B(e,(e.gzhead.text?1:0)+(e.gzhead.hcrc?2:0)+(e.gzhead.extra?4:0)+(e.gzhead.name?8:0)+(e.gzhead.comment?16:0)),B(e,e.gzhead.time&255),B(e,e.gzhead.time>>8&255),B(e,e.gzhead.time>>16&255),B(e,e.gzhead.time>>24&255),B(e,e.level===9?2:e.strategy>=ne||e.level<2?4:0),B(e,e.gzhead.os&255),e.gzhead.extra&&e.gzhead.extra.length&&(B(e,e.gzhead.extra.length&255),B(e,e.gzhead.extra.length>>8&255)),e.gzhead.hcrc&&(t.adler=Z(t.adler,e.pending_buf,e.pending,0)),e.gzindex=0,e.status=$e;else if(B(e,0),B(e,0),B(e,0),B(e,0),B(e,0),B(e,e.level===9?2:e.strategy>=ne||e.level<2?4:0),B(e,Pa),e.status=_t,j(t),e.pending!==0)return e.last_flush=-1,F}if(e.status===$e){if(e.gzhead.extra){let a=e.pending,r=(e.gzhead.extra.length&65535)-e.gzindex;for(;e.pending+r>e.pending_buf_size;){let l=e.pending_buf_size-e.pending;if(e.pending_buf.set(e.gzhead.extra.subarray(e.gzindex,e.gzindex+l),e.pending),e.pending=e.pending_buf_size,e.gzhead.hcrc&&e.pending>a&&(t.adler=Z(t.adler,e.pending_buf,e.pending-a,a)),e.gzindex+=l,j(t),e.pending!==0)return e.last_flush=-1,F;a=0,r-=l}let o=new Uint8Array(e.gzhead.extra);e.pending_buf.set(o.subarray(e.gzindex,e.gzindex+r),e.pending),e.pending+=r,e.gzhead.hcrc&&e.pending>a&&(t.adler=Z(t.adler,e.pending_buf,e.pending-a,a)),e.gzindex=0}e.status=He}if(e.status===He){if(e.gzhead.name){let a=e.pending,r;do{if(e.pending===e.pending_buf_size){if(e.gzhead.hcrc&&e.pending>a&&(t.adler=Z(t.adler,e.pending_buf,e.pending-a,a)),j(t),e.pending!==0)return e.last_flush=-1,F;a=0}e.gzindex<e.gzhead.name.length?r=e.gzhead.name.charCodeAt(e.gzindex++)&255:r=0,B(e,r)}while(r!==0);e.gzhead.hcrc&&e.pending>a&&(t.adler=Z(t.adler,e.pending_buf,e.pending-a,a)),e.gzindex=0}e.status=Pe}if(e.status===Pe){if(e.gzhead.comment){let a=e.pending,r;do{if(e.pending===e.pending_buf_size){if(e.gzhead.hcrc&&e.pending>a&&(t.adler=Z(t.adler,e.pending_buf,e.pending-a,a)),j(t),e.pending!==0)return e.last_flush=-1,F;a=0}e.gzindex<e.gzhead.comment.length?r=e.gzhead.comment.charCodeAt(e.gzindex++)&255:r=0,B(e,r)}while(r!==0);e.gzhead.hcrc&&e.pending>a&&(t.adler=Z(t.adler,e.pending_buf,e.pending-a,a))}e.status=We}if(e.status===We){if(e.gzhead.hcrc){if(e.pending+2>e.pending_buf_size&&(j(t),e.pending!==0))return e.last_flush=-1,F;B(e,t.adler&255),B(e,t.adler>>8&255),t.adler=0}if(e.status=_t,j(t),e.pending!==0)return e.last_flush=-1,F}if(t.avail_in!==0||e.lookahead!==0||i!==lt&&e.status!==Dt){let a=e.level===0?dn(e,i):e.strategy===ne?Xa(e,i):e.strategy===Ra?Ga(e,i):It[e.level].func(e,i);if((a===pt||a===Rt)&&(e.status=Dt),a===$||a===pt)return t.avail_out===0&&(e.last_flush=-1),F;if(a===Tt&&(i===Aa?Ea(e):i!==di&&(Ze(e,0,0,!1),i===za&&(rt(e.head),e.lookahead===0&&(e.strstart=0,e.block_start=0,e.insert=0))),j(t),t.avail_out===0))return e.last_flush=-1,F}return i!==Y?F:e.wrap<=0?_i:(e.wrap===2?(B(e,t.adler&255),B(e,t.adler>>8&255),B(e,t.adler>>16&255),B(e,t.adler>>24&255),B(e,t.total_in&255),B(e,t.total_in>>8&255),B(e,t.total_in>>16&255),B(e,t.total_in>>24&255)):(Bt(e,t.adler>>>16),Bt(e,t.adler&65535)),j(t),e.wrap>0&&(e.wrap=-e.wrap),e.pending!==0?F:_i)},tr=t=>{if(ee(t))return tt;const i=t.state.status;return t.state=null,i===_t?ut(t,Sa):F},er=(t,i)=>{let e=i.length;if(ee(t))return tt;const n=t.state,a=n.wrap;if(a===2||a===1&&n.status!==zt||n.lookahead)return tt;if(a===1&&(t.adler=Yt(t.adler,i,e,0)),n.wrap=0,e>=n.w_size){a===0&&(rt(n.head),n.strstart=0,n.block_start=0,n.insert=0);let f=new Uint8Array(n.w_size);f.set(i.subarray(e-n.w_size,e),0),i=f,e=n.w_size}const r=t.avail_in,o=t.next_in,l=t.input;for(t.avail_in=e,t.next_in=0,t.input=i,St(n);n.lookahead>=U;){let f=n.strstart,s=n.lookahead-(U-1);do n.ins_h=ht(n,n.ins_h,n.window[f+U-1]),n.prev[f&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=f,f++;while(--s);n.strstart=f,n.lookahead=U-1,St(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=U-1,n.match_available=0,t.next_in=o,t.input=l,t.avail_in=r,n.wrap=a,F};var ir=Ja,nr=wn,ar=un,rr=_n,sr=qa,or=Qa,lr=tr,hr=er,fr="pako deflate (from Nodeca project)",$t={deflateInit:ir,deflateInit2:nr,deflateReset:ar,deflateResetKeep:rr,deflateSetHeader:sr,deflate:or,deflateEnd:lr,deflateSetDictionary:hr,deflateInfo:fr};const cr=(t,i)=>Object.prototype.hasOwnProperty.call(t,i);var dr=function(t){const i=Array.prototype.slice.call(arguments,1);for(;i.length;){const e=i.shift();if(!!e){if(typeof e!="object")throw new TypeError(e+"must be non-object");for(const n in e)cr(e,n)&&(t[n]=e[n])}}return t},_r=t=>{let i=0;for(let n=0,a=t.length;n<a;n++)i+=t[n].length;const e=new Uint8Array(i);for(let n=0,a=0,r=t.length;n<r;n++){let o=t[n];e.set(o,a),a+=o.length}return e},ge={assign:dr,flattenChunks:_r};let pn=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{pn=!1}const Kt=new Uint8Array(256);for(let t=0;t<256;t++)Kt[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;Kt[254]=Kt[254]=1;var ur=t=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(t);let i,e,n,a,r,o=t.length,l=0;for(a=0;a<o;a++)e=t.charCodeAt(a),(e&64512)===55296&&a+1<o&&(n=t.charCodeAt(a+1),(n&64512)===56320&&(e=65536+(e-55296<<10)+(n-56320),a++)),l+=e<128?1:e<2048?2:e<65536?3:4;for(i=new Uint8Array(l),r=0,a=0;r<l;a++)e=t.charCodeAt(a),(e&64512)===55296&&a+1<o&&(n=t.charCodeAt(a+1),(n&64512)===56320&&(e=65536+(e-55296<<10)+(n-56320),a++)),e<128?i[r++]=e:e<2048?(i[r++]=192|e>>>6,i[r++]=128|e&63):e<65536?(i[r++]=224|e>>>12,i[r++]=128|e>>>6&63,i[r++]=128|e&63):(i[r++]=240|e>>>18,i[r++]=128|e>>>12&63,i[r++]=128|e>>>6&63,i[r++]=128|e&63);return i};const wr=(t,i)=>{if(i<65534&&t.subarray&&pn)return String.fromCharCode.apply(null,t.length===i?t:t.subarray(0,i));let e="";for(let n=0;n<i;n++)e+=String.fromCharCode(t[n]);return e};var pr=(t,i)=>{const e=i||t.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(t.subarray(0,i));let n,a;const r=new Array(e*2);for(a=0,n=0;n<e;){let o=t[n++];if(o<128){r[a++]=o;continue}let l=Kt[o];if(l>4){r[a++]=65533,n+=l-1;continue}for(o&=l===2?31:l===3?15:7;l>1&&n<e;)o=o<<6|t[n++]&63,l--;if(l>1){r[a++]=65533;continue}o<65536?r[a++]=o:(o-=65536,r[a++]=55296|o>>10&1023,r[a++]=56320|o&1023)}return wr(r,a)},gr=(t,i)=>{i=i||t.length,i>t.length&&(i=t.length);let e=i-1;for(;e>=0&&(t[e]&192)===128;)e--;return e<0||e===0?i:e+Kt[t[e]]>i?e:i},qt={string2buf:ur,buf2string:pr,utf8border:gr};function xr(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var gn=xr;const xn=Object.prototype.toString,{Z_NO_FLUSH:br,Z_SYNC_FLUSH:yr,Z_FULL_FLUSH:vr,Z_FINISH:mr,Z_OK:de,Z_STREAM_END:kr,Z_DEFAULT_COMPRESSION:Er,Z_DEFAULT_STRATEGY:Ar,Z_DEFLATED:zr}=te;function Qe(t){this.options=ge.assign({level:Er,method:zr,chunkSize:16384,windowBits:15,memLevel:8,strategy:Ar},t||{});let i=this.options;i.raw&&i.windowBits>0?i.windowBits=-i.windowBits:i.gzip&&i.windowBits>0&&i.windowBits<16&&(i.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new gn,this.strm.avail_out=0;let e=$t.deflateInit2(this.strm,i.level,i.method,i.windowBits,i.memLevel,i.strategy);if(e!==de)throw new Error(At[e]);if(i.header&&$t.deflateSetHeader(this.strm,i.header),i.dictionary){let n;if(typeof i.dictionary=="string"?n=qt.string2buf(i.dictionary):xn.call(i.dictionary)==="[object ArrayBuffer]"?n=new Uint8Array(i.dictionary):n=i.dictionary,e=$t.deflateSetDictionary(this.strm,n),e!==de)throw new Error(At[e]);this._dict_set=!0}}Qe.prototype.push=function(t,i){const e=this.strm,n=this.options.chunkSize;let a,r;if(this.ended)return!1;for(i===~~i?r=i:r=i===!0?mr:br,typeof t=="string"?e.input=qt.string2buf(t):xn.call(t)==="[object ArrayBuffer]"?e.input=new Uint8Array(t):e.input=t,e.next_in=0,e.avail_in=e.input.length;;){if(e.avail_out===0&&(e.output=new Uint8Array(n),e.next_out=0,e.avail_out=n),(r===yr||r===vr)&&e.avail_out<=6){this.onData(e.output.subarray(0,e.next_out)),e.avail_out=0;continue}if(a=$t.deflate(e,r),a===kr)return e.next_out>0&&this.onData(e.output.subarray(0,e.next_out)),a=$t.deflateEnd(this.strm),this.onEnd(a),this.ended=!0,a===de;if(e.avail_out===0){this.onData(e.output);continue}if(r>0&&e.next_out>0){this.onData(e.output.subarray(0,e.next_out)),e.avail_out=0;continue}if(e.avail_in===0)break}return!0};Qe.prototype.onData=function(t){this.chunks.push(t)};Qe.prototype.onEnd=function(t){t===de&&(this.result=ge.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};const ae=16209,Sr=16191;var Cr=function(i,e){let n,a,r,o,l,f,s,h,w,_,d,p,z,E,m,A,S,c,u,y,x,N,T,k;const C=i.state;n=i.next_in,T=i.input,a=n+(i.avail_in-5),r=i.next_out,k=i.output,o=r-(e-i.avail_out),l=r+(i.avail_out-257),f=C.dmax,s=C.wsize,h=C.whave,w=C.wnext,_=C.window,d=C.hold,p=C.bits,z=C.lencode,E=C.distcode,m=(1<<C.lenbits)-1,A=(1<<C.distbits)-1;t:do{p<15&&(d+=T[n++]<<p,p+=8,d+=T[n++]<<p,p+=8),S=z[d&m];e:for(;;){if(c=S>>>24,d>>>=c,p-=c,c=S>>>16&255,c===0)k[r++]=S&65535;else if(c&16){u=S&65535,c&=15,c&&(p<c&&(d+=T[n++]<<p,p+=8),u+=d&(1<<c)-1,d>>>=c,p-=c),p<15&&(d+=T[n++]<<p,p+=8,d+=T[n++]<<p,p+=8),S=E[d&A];i:for(;;){if(c=S>>>24,d>>>=c,p-=c,c=S>>>16&255,c&16){if(y=S&65535,c&=15,p<c&&(d+=T[n++]<<p,p+=8,p<c&&(d+=T[n++]<<p,p+=8)),y+=d&(1<<c)-1,y>f){i.msg="invalid distance too far back",C.mode=ae;break t}if(d>>>=c,p-=c,c=r-o,y>c){if(c=y-c,c>h&&C.sane){i.msg="invalid distance too far back",C.mode=ae;break t}if(x=0,N=_,w===0){if(x+=s-c,c<u){u-=c;do k[r++]=_[x++];while(--c);x=r-y,N=k}}else if(w<c){if(x+=s+w-c,c-=w,c<u){u-=c;do k[r++]=_[x++];while(--c);if(x=0,w<u){c=w,u-=c;do k[r++]=_[x++];while(--c);x=r-y,N=k}}}else if(x+=w-c,c<u){u-=c;do k[r++]=_[x++];while(--c);x=r-y,N=k}for(;u>2;)k[r++]=N[x++],k[r++]=N[x++],k[r++]=N[x++],u-=3;u&&(k[r++]=N[x++],u>1&&(k[r++]=N[x++]))}else{x=r-y;do k[r++]=k[x++],k[r++]=k[x++],k[r++]=k[x++],u-=3;while(u>2);u&&(k[r++]=k[x++],u>1&&(k[r++]=k[x++]))}}else if((c&64)===0){S=E[(S&65535)+(d&(1<<c)-1)];continue i}else{i.msg="invalid distance code",C.mode=ae;break t}break}}else if((c&64)===0){S=z[(S&65535)+(d&(1<<c)-1)];continue e}else if(c&32){C.mode=Sr;break t}else{i.msg="invalid literal/length code",C.mode=ae;break t}break}}while(n<a&&r<l);u=p>>3,n-=u,p-=u<<3,d&=(1<<p)-1,i.next_in=n,i.next_out=r,i.avail_in=n<a?5+(a-n):5-(n-a),i.avail_out=r<l?257+(l-r):257-(r-l),C.hold=d,C.bits=p};const mt=15,wi=852,pi=592,gi=0,ze=1,xi=2,Tr=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Rr=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Ur=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Mr=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),Nr=(t,i,e,n,a,r,o,l)=>{const f=l.bits;let s=0,h=0,w=0,_=0,d=0,p=0,z=0,E=0,m=0,A=0,S,c,u,y,x,N=null,T;const k=new Uint16Array(mt+1),C=new Uint16Array(mt+1);let O=null,V,I,D;for(s=0;s<=mt;s++)k[s]=0;for(h=0;h<n;h++)k[i[e+h]]++;for(d=f,_=mt;_>=1&&k[_]===0;_--);if(d>_&&(d=_),_===0)return a[r++]=1<<24|64<<16|0,a[r++]=1<<24|64<<16|0,l.bits=1,0;for(w=1;w<_&&k[w]===0;w++);for(d<w&&(d=w),E=1,s=1;s<=mt;s++)if(E<<=1,E-=k[s],E<0)return-1;if(E>0&&(t===gi||_!==1))return-1;for(C[1]=0,s=1;s<mt;s++)C[s+1]=C[s]+k[s];for(h=0;h<n;h++)i[e+h]!==0&&(o[C[i[e+h]]++]=h);if(t===gi?(N=O=o,T=20):t===ze?(N=Tr,O=Rr,T=257):(N=Ur,O=Mr,T=0),A=0,h=0,s=w,x=r,p=d,z=0,u=-1,m=1<<d,y=m-1,t===ze&&m>wi||t===xi&&m>pi)return 1;for(;;){V=s-z,o[h]+1<T?(I=0,D=o[h]):o[h]>=T?(I=O[o[h]-T],D=N[o[h]-T]):(I=32+64,D=0),S=1<<s-z,c=1<<p,w=c;do c-=S,a[x+(A>>z)+c]=V<<24|I<<16|D|0;while(c!==0);for(S=1<<s-1;A&S;)S>>=1;if(S!==0?(A&=S-1,A+=S):A=0,h++,--k[s]===0){if(s===_)break;s=i[e+o[h]]}if(s>d&&(A&y)!==u){for(z===0&&(z=d),x+=w,p=s-z,E=1<<p;p+z<_&&(E-=k[p+z],!(E<=0));)p++,E<<=1;if(m+=1<<p,t===ze&&m>wi||t===xi&&m>pi)return 1;u=A&y,a[u]=d<<24|p<<16|x-r|0}}return A!==0&&(a[x+A]=s-z<<24|64<<16|0),l.bits=d,0};var Ht=Nr;const Br=0,bn=1,yn=2,{Z_FINISH:bi,Z_BLOCK:Or,Z_TREES:re,Z_OK:gt,Z_STREAM_END:Lr,Z_NEED_DICT:Dr,Z_STREAM_ERROR:K,Z_DATA_ERROR:vn,Z_MEM_ERROR:mn,Z_BUF_ERROR:Ir,Z_DEFLATED:yi}=te,xe=16180,vi=16181,mi=16182,ki=16183,Ei=16184,Ai=16185,zi=16186,Si=16187,Ci=16188,Ti=16189,_e=16190,it=16191,Se=16192,Ri=16193,Ce=16194,Ui=16195,Mi=16196,Ni=16197,Bi=16198,se=16199,oe=16200,Oi=16201,Li=16202,Di=16203,Ii=16204,Vi=16205,Te=16206,Zi=16207,Fi=16208,L=16209,kn=16210,En=16211,Vr=852,Zr=592,Fr=15,$r=Fr,$i=t=>(t>>>24&255)+(t>>>8&65280)+((t&65280)<<8)+((t&255)<<24);function Hr(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const xt=t=>{if(!t)return 1;const i=t.state;return!i||i.strm!==t||i.mode<xe||i.mode>En?1:0},An=t=>{if(xt(t))return K;const i=t.state;return t.total_in=t.total_out=i.total=0,t.msg="",i.wrap&&(t.adler=i.wrap&1),i.mode=xe,i.last=0,i.havedict=0,i.flags=-1,i.dmax=32768,i.head=null,i.hold=0,i.bits=0,i.lencode=i.lendyn=new Int32Array(Vr),i.distcode=i.distdyn=new Int32Array(Zr),i.sane=1,i.back=-1,gt},zn=t=>{if(xt(t))return K;const i=t.state;return i.wsize=0,i.whave=0,i.wnext=0,An(t)},Sn=(t,i)=>{let e;if(xt(t))return K;const n=t.state;return i<0?(e=0,i=-i):(e=(i>>4)+5,i<48&&(i&=15)),i&&(i<8||i>15)?K:(n.window!==null&&n.wbits!==i&&(n.window=null),n.wrap=e,n.wbits=i,zn(t))},Cn=(t,i)=>{if(!t)return K;const e=new Hr;t.state=e,e.strm=t,e.window=null,e.mode=xe;const n=Sn(t,i);return n!==gt&&(t.state=null),n},Pr=t=>Cn(t,$r);let Hi=!0,Re,Ue;const Wr=t=>{if(Hi){Re=new Int32Array(512),Ue=new Int32Array(32);let i=0;for(;i<144;)t.lens[i++]=8;for(;i<256;)t.lens[i++]=9;for(;i<280;)t.lens[i++]=7;for(;i<288;)t.lens[i++]=8;for(Ht(bn,t.lens,0,288,Re,0,t.work,{bits:9}),i=0;i<32;)t.lens[i++]=5;Ht(yn,t.lens,0,32,Ue,0,t.work,{bits:5}),Hi=!1}t.lencode=Re,t.lenbits=9,t.distcode=Ue,t.distbits=5},Tn=(t,i,e,n)=>{let a;const r=t.state;return r.window===null&&(r.wsize=1<<r.wbits,r.wnext=0,r.whave=0,r.window=new Uint8Array(r.wsize)),n>=r.wsize?(r.window.set(i.subarray(e-r.wsize,e),0),r.wnext=0,r.whave=r.wsize):(a=r.wsize-r.wnext,a>n&&(a=n),r.window.set(i.subarray(e-n,e-n+a),r.wnext),n-=a,n?(r.window.set(i.subarray(e-n,e),0),r.wnext=n,r.whave=r.wsize):(r.wnext+=a,r.wnext===r.wsize&&(r.wnext=0),r.whave<r.wsize&&(r.whave+=a))),0},jr=(t,i)=>{let e,n,a,r,o,l,f,s,h,w,_,d,p,z,E=0,m,A,S,c,u,y,x,N;const T=new Uint8Array(4);let k,C;const O=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(xt(t)||!t.output||!t.input&&t.avail_in!==0)return K;e=t.state,e.mode===it&&(e.mode=Se),o=t.next_out,a=t.output,f=t.avail_out,r=t.next_in,n=t.input,l=t.avail_in,s=e.hold,h=e.bits,w=l,_=f,N=gt;t:for(;;)switch(e.mode){case xe:if(e.wrap===0){e.mode=Se;break}for(;h<16;){if(l===0)break t;l--,s+=n[r++]<<h,h+=8}if(e.wrap&2&&s===35615){e.wbits===0&&(e.wbits=15),e.check=0,T[0]=s&255,T[1]=s>>>8&255,e.check=Z(e.check,T,2,0),s=0,h=0,e.mode=vi;break}if(e.head&&(e.head.done=!1),!(e.wrap&1)||(((s&255)<<8)+(s>>8))%31){t.msg="incorrect header check",e.mode=L;break}if((s&15)!==yi){t.msg="unknown compression method",e.mode=L;break}if(s>>>=4,h-=4,x=(s&15)+8,e.wbits===0&&(e.wbits=x),x>15||x>e.wbits){t.msg="invalid window size",e.mode=L;break}e.dmax=1<<e.wbits,e.flags=0,t.adler=e.check=1,e.mode=s&512?Ti:it,s=0,h=0;break;case vi:for(;h<16;){if(l===0)break t;l--,s+=n[r++]<<h,h+=8}if(e.flags=s,(e.flags&255)!==yi){t.msg="unknown compression method",e.mode=L;break}if(e.flags&57344){t.msg="unknown header flags set",e.mode=L;break}e.head&&(e.head.text=s>>8&1),e.flags&512&&e.wrap&4&&(T[0]=s&255,T[1]=s>>>8&255,e.check=Z(e.check,T,2,0)),s=0,h=0,e.mode=mi;case mi:for(;h<32;){if(l===0)break t;l--,s+=n[r++]<<h,h+=8}e.head&&(e.head.time=s),e.flags&512&&e.wrap&4&&(T[0]=s&255,T[1]=s>>>8&255,T[2]=s>>>16&255,T[3]=s>>>24&255,e.check=Z(e.check,T,4,0)),s=0,h=0,e.mode=ki;case ki:for(;h<16;){if(l===0)break t;l--,s+=n[r++]<<h,h+=8}e.head&&(e.head.xflags=s&255,e.head.os=s>>8),e.flags&512&&e.wrap&4&&(T[0]=s&255,T[1]=s>>>8&255,e.check=Z(e.check,T,2,0)),s=0,h=0,e.mode=Ei;case Ei:if(e.flags&1024){for(;h<16;){if(l===0)break t;l--,s+=n[r++]<<h,h+=8}e.length=s,e.head&&(e.head.extra_len=s),e.flags&512&&e.wrap&4&&(T[0]=s&255,T[1]=s>>>8&255,e.check=Z(e.check,T,2,0)),s=0,h=0}else e.head&&(e.head.extra=null);e.mode=Ai;case Ai:if(e.flags&1024&&(d=e.length,d>l&&(d=l),d&&(e.head&&(x=e.head.extra_len-e.length,e.head.extra||(e.head.extra=new Uint8Array(e.head.extra_len)),e.head.extra.set(n.subarray(r,r+d),x)),e.flags&512&&e.wrap&4&&(e.check=Z(e.check,n,d,r)),l-=d,r+=d,e.length-=d),e.length))break t;e.length=0,e.mode=zi;case zi:if(e.flags&2048){if(l===0)break t;d=0;do x=n[r+d++],e.head&&x&&e.length<65536&&(e.head.name+=String.fromCharCode(x));while(x&&d<l);if(e.flags&512&&e.wrap&4&&(e.check=Z(e.check,n,d,r)),l-=d,r+=d,x)break t}else e.head&&(e.head.name=null);e.length=0,e.mode=Si;case Si:if(e.flags&4096){if(l===0)break t;d=0;do x=n[r+d++],e.head&&x&&e.length<65536&&(e.head.comment+=String.fromCharCode(x));while(x&&d<l);if(e.flags&512&&e.wrap&4&&(e.check=Z(e.check,n,d,r)),l-=d,r+=d,x)break t}else e.head&&(e.head.comment=null);e.mode=Ci;case Ci:if(e.flags&512){for(;h<16;){if(l===0)break t;l--,s+=n[r++]<<h,h+=8}if(e.wrap&4&&s!==(e.check&65535)){t.msg="header crc mismatch",e.mode=L;break}s=0,h=0}e.head&&(e.head.hcrc=e.flags>>9&1,e.head.done=!0),t.adler=e.check=0,e.mode=it;break;case Ti:for(;h<32;){if(l===0)break t;l--,s+=n[r++]<<h,h+=8}t.adler=e.check=$i(s),s=0,h=0,e.mode=_e;case _e:if(e.havedict===0)return t.next_out=o,t.avail_out=f,t.next_in=r,t.avail_in=l,e.hold=s,e.bits=h,Dr;t.adler=e.check=1,e.mode=it;case it:if(i===Or||i===re)break t;case Se:if(e.last){s>>>=h&7,h-=h&7,e.mode=Te;break}for(;h<3;){if(l===0)break t;l--,s+=n[r++]<<h,h+=8}switch(e.last=s&1,s>>>=1,h-=1,s&3){case 0:e.mode=Ri;break;case 1:if(Wr(e),e.mode=se,i===re){s>>>=2,h-=2;break t}break;case 2:e.mode=Mi;break;case 3:t.msg="invalid block type",e.mode=L}s>>>=2,h-=2;break;case Ri:for(s>>>=h&7,h-=h&7;h<32;){if(l===0)break t;l--,s+=n[r++]<<h,h+=8}if((s&65535)!==(s>>>16^65535)){t.msg="invalid stored block lengths",e.mode=L;break}if(e.length=s&65535,s=0,h=0,e.mode=Ce,i===re)break t;case Ce:e.mode=Ui;case Ui:if(d=e.length,d){if(d>l&&(d=l),d>f&&(d=f),d===0)break t;a.set(n.subarray(r,r+d),o),l-=d,r+=d,f-=d,o+=d,e.length-=d;break}e.mode=it;break;case Mi:for(;h<14;){if(l===0)break t;l--,s+=n[r++]<<h,h+=8}if(e.nlen=(s&31)+257,s>>>=5,h-=5,e.ndist=(s&31)+1,s>>>=5,h-=5,e.ncode=(s&15)+4,s>>>=4,h-=4,e.nlen>286||e.ndist>30){t.msg="too many length or distance symbols",e.mode=L;break}e.have=0,e.mode=Ni;case Ni:for(;e.have<e.ncode;){for(;h<3;){if(l===0)break t;l--,s+=n[r++]<<h,h+=8}e.lens[O[e.have++]]=s&7,s>>>=3,h-=3}for(;e.have<19;)e.lens[O[e.have++]]=0;if(e.lencode=e.lendyn,e.lenbits=7,k={bits:e.lenbits},N=Ht(Br,e.lens,0,19,e.lencode,0,e.work,k),e.lenbits=k.bits,N){t.msg="invalid code lengths set",e.mode=L;break}e.have=0,e.mode=Bi;case Bi:for(;e.have<e.nlen+e.ndist;){for(;E=e.lencode[s&(1<<e.lenbits)-1],m=E>>>24,A=E>>>16&255,S=E&65535,!(m<=h);){if(l===0)break t;l--,s+=n[r++]<<h,h+=8}if(S<16)s>>>=m,h-=m,e.lens[e.have++]=S;else{if(S===16){for(C=m+2;h<C;){if(l===0)break t;l--,s+=n[r++]<<h,h+=8}if(s>>>=m,h-=m,e.have===0){t.msg="invalid bit length repeat",e.mode=L;break}x=e.lens[e.have-1],d=3+(s&3),s>>>=2,h-=2}else if(S===17){for(C=m+3;h<C;){if(l===0)break t;l--,s+=n[r++]<<h,h+=8}s>>>=m,h-=m,x=0,d=3+(s&7),s>>>=3,h-=3}else{for(C=m+7;h<C;){if(l===0)break t;l--,s+=n[r++]<<h,h+=8}s>>>=m,h-=m,x=0,d=11+(s&127),s>>>=7,h-=7}if(e.have+d>e.nlen+e.ndist){t.msg="invalid bit length repeat",e.mode=L;break}for(;d--;)e.lens[e.have++]=x}}if(e.mode===L)break;if(e.lens[256]===0){t.msg="invalid code -- missing end-of-block",e.mode=L;break}if(e.lenbits=9,k={bits:e.lenbits},N=Ht(bn,e.lens,0,e.nlen,e.lencode,0,e.work,k),e.lenbits=k.bits,N){t.msg="invalid literal/lengths set",e.mode=L;break}if(e.distbits=6,e.distcode=e.distdyn,k={bits:e.distbits},N=Ht(yn,e.lens,e.nlen,e.ndist,e.distcode,0,e.work,k),e.distbits=k.bits,N){t.msg="invalid distances set",e.mode=L;break}if(e.mode=se,i===re)break t;case se:e.mode=oe;case oe:if(l>=6&&f>=258){t.next_out=o,t.avail_out=f,t.next_in=r,t.avail_in=l,e.hold=s,e.bits=h,Cr(t,_),o=t.next_out,a=t.output,f=t.avail_out,r=t.next_in,n=t.input,l=t.avail_in,s=e.hold,h=e.bits,e.mode===it&&(e.back=-1);break}for(e.back=0;E=e.lencode[s&(1<<e.lenbits)-1],m=E>>>24,A=E>>>16&255,S=E&65535,!(m<=h);){if(l===0)break t;l--,s+=n[r++]<<h,h+=8}if(A&&(A&240)===0){for(c=m,u=A,y=S;E=e.lencode[y+((s&(1<<c+u)-1)>>c)],m=E>>>24,A=E>>>16&255,S=E&65535,!(c+m<=h);){if(l===0)break t;l--,s+=n[r++]<<h,h+=8}s>>>=c,h-=c,e.back+=c}if(s>>>=m,h-=m,e.back+=m,e.length=S,A===0){e.mode=Vi;break}if(A&32){e.back=-1,e.mode=it;break}if(A&64){t.msg="invalid literal/length code",e.mode=L;break}e.extra=A&15,e.mode=Oi;case Oi:if(e.extra){for(C=e.extra;h<C;){if(l===0)break t;l--,s+=n[r++]<<h,h+=8}e.length+=s&(1<<e.extra)-1,s>>>=e.extra,h-=e.extra,e.back+=e.extra}e.was=e.length,e.mode=Li;case Li:for(;E=e.distcode[s&(1<<e.distbits)-1],m=E>>>24,A=E>>>16&255,S=E&65535,!(m<=h);){if(l===0)break t;l--,s+=n[r++]<<h,h+=8}if((A&240)===0){for(c=m,u=A,y=S;E=e.distcode[y+((s&(1<<c+u)-1)>>c)],m=E>>>24,A=E>>>16&255,S=E&65535,!(c+m<=h);){if(l===0)break t;l--,s+=n[r++]<<h,h+=8}s>>>=c,h-=c,e.back+=c}if(s>>>=m,h-=m,e.back+=m,A&64){t.msg="invalid distance code",e.mode=L;break}e.offset=S,e.extra=A&15,e.mode=Di;case Di:if(e.extra){for(C=e.extra;h<C;){if(l===0)break t;l--,s+=n[r++]<<h,h+=8}e.offset+=s&(1<<e.extra)-1,s>>>=e.extra,h-=e.extra,e.back+=e.extra}if(e.offset>e.dmax){t.msg="invalid distance too far back",e.mode=L;break}e.mode=Ii;case Ii:if(f===0)break t;if(d=_-f,e.offset>d){if(d=e.offset-d,d>e.whave&&e.sane){t.msg="invalid distance too far back",e.mode=L;break}d>e.wnext?(d-=e.wnext,p=e.wsize-d):p=e.wnext-d,d>e.length&&(d=e.length),z=e.window}else z=a,p=o-e.offset,d=e.length;d>f&&(d=f),f-=d,e.length-=d;do a[o++]=z[p++];while(--d);e.length===0&&(e.mode=oe);break;case Vi:if(f===0)break t;a[o++]=e.length,f--,e.mode=oe;break;case Te:if(e.wrap){for(;h<32;){if(l===0)break t;l--,s|=n[r++]<<h,h+=8}if(_-=f,t.total_out+=_,e.total+=_,e.wrap&4&&_&&(t.adler=e.check=e.flags?Z(e.check,a,_,o-_):Yt(e.check,a,_,o-_)),_=f,e.wrap&4&&(e.flags?s:$i(s))!==e.check){t.msg="incorrect data check",e.mode=L;break}s=0,h=0}e.mode=Zi;case Zi:if(e.wrap&&e.flags){for(;h<32;){if(l===0)break t;l--,s+=n[r++]<<h,h+=8}if(e.wrap&4&&s!==(e.total&4294967295)){t.msg="incorrect length check",e.mode=L;break}s=0,h=0}e.mode=Fi;case Fi:N=Lr;break t;case L:N=vn;break t;case kn:return mn;case En:default:return K}return t.next_out=o,t.avail_out=f,t.next_in=r,t.avail_in=l,e.hold=s,e.bits=h,(e.wsize||_!==t.avail_out&&e.mode<L&&(e.mode<Te||i!==bi))&&Tn(t,t.output,t.next_out,_-t.avail_out),w-=t.avail_in,_-=t.avail_out,t.total_in+=w,t.total_out+=_,e.total+=_,e.wrap&4&&_&&(t.adler=e.check=e.flags?Z(e.check,a,_,t.next_out-_):Yt(e.check,a,_,t.next_out-_)),t.data_type=e.bits+(e.last?64:0)+(e.mode===it?128:0)+(e.mode===se||e.mode===Ce?256:0),(w===0&&_===0||i===bi)&&N===gt&&(N=Ir),N},Gr=t=>{if(xt(t))return K;let i=t.state;return i.window&&(i.window=null),t.state=null,gt},Xr=(t,i)=>{if(xt(t))return K;const e=t.state;return(e.wrap&2)===0?K:(e.head=i,i.done=!1,gt)},Yr=(t,i)=>{const e=i.length;let n,a,r;return xt(t)||(n=t.state,n.wrap!==0&&n.mode!==_e)?K:n.mode===_e&&(a=1,a=Yt(a,i,e,0),a!==n.check)?vn:(r=Tn(t,i,e,e),r?(n.mode=kn,mn):(n.havedict=1,gt))};var Kr=zn,qr=Sn,Jr=An,Qr=Pr,ts=Cn,es=jr,is=Gr,ns=Xr,as=Yr,rs="pako inflate (from Nodeca project)",at={inflateReset:Kr,inflateReset2:qr,inflateResetKeep:Jr,inflateInit:Qr,inflateInit2:ts,inflate:es,inflateEnd:is,inflateGetHeader:ns,inflateSetDictionary:as,inflateInfo:rs};function ss(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var os=ss;const Rn=Object.prototype.toString,{Z_NO_FLUSH:ls,Z_FINISH:hs,Z_OK:Jt,Z_STREAM_END:Me,Z_NEED_DICT:Ne,Z_STREAM_ERROR:fs,Z_DATA_ERROR:Pi,Z_MEM_ERROR:cs}=te;function ie(t){this.options=ge.assign({chunkSize:1024*64,windowBits:15,to:""},t||{});const i=this.options;i.raw&&i.windowBits>=0&&i.windowBits<16&&(i.windowBits=-i.windowBits,i.windowBits===0&&(i.windowBits=-15)),i.windowBits>=0&&i.windowBits<16&&!(t&&t.windowBits)&&(i.windowBits+=32),i.windowBits>15&&i.windowBits<48&&(i.windowBits&15)===0&&(i.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new gn,this.strm.avail_out=0;let e=at.inflateInit2(this.strm,i.windowBits);if(e!==Jt)throw new Error(At[e]);if(this.header=new os,at.inflateGetHeader(this.strm,this.header),i.dictionary&&(typeof i.dictionary=="string"?i.dictionary=qt.string2buf(i.dictionary):Rn.call(i.dictionary)==="[object ArrayBuffer]"&&(i.dictionary=new Uint8Array(i.dictionary)),i.raw&&(e=at.inflateSetDictionary(this.strm,i.dictionary),e!==Jt)))throw new Error(At[e])}ie.prototype.push=function(t,i){const e=this.strm,n=this.options.chunkSize,a=this.options.dictionary;let r,o,l;if(this.ended)return!1;for(i===~~i?o=i:o=i===!0?hs:ls,Rn.call(t)==="[object ArrayBuffer]"?e.input=new Uint8Array(t):e.input=t,e.next_in=0,e.avail_in=e.input.length;;){for(e.avail_out===0&&(e.output=new Uint8Array(n),e.next_out=0,e.avail_out=n),r=at.inflate(e,o),r===Ne&&a&&(r=at.inflateSetDictionary(e,a),r===Jt?r=at.inflate(e,o):r===Pi&&(r=Ne));e.avail_in>0&&r===Me&&e.state.wrap>0&&t[e.next_in]!==0;)at.inflateReset(e),r=at.inflate(e,o);switch(r){case fs:case Pi:case Ne:case cs:return this.onEnd(r),this.ended=!0,!1}if(l=e.avail_out,e.next_out&&(e.avail_out===0||r===Me))if(this.options.to==="string"){let f=qt.utf8border(e.output,e.next_out),s=e.next_out-f,h=qt.buf2string(e.output,f);e.next_out=s,e.avail_out=n-s,s&&e.output.set(e.output.subarray(f,f+s),0),this.onData(h)}else this.onData(e.output.length===e.next_out?e.output:e.output.subarray(0,e.next_out));if(!(r===Jt&&l===0)){if(r===Me)return r=at.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,!0;if(e.avail_in===0)break}}return!0};ie.prototype.onData=function(t){this.chunks.push(t)};ie.prototype.onEnd=function(t){t===Jt&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=ge.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};function ti(t,i){const e=new ie(i);if(e.push(t),e.err)throw e.msg||At[e.err];return e.result}function ds(t,i){return i=i||{},i.raw=!0,ti(t,i)}var _s=ie,us=ti,ws=ds,ps=ti,gs=te,xs={Inflate:_s,inflate:us,inflateRaw:ws,ungzip:ps,constants:gs};const{Inflate:bs,inflate:ys,inflateRaw:Ps,ungzip:Ws}=xs;var vs=bs,ms=ys;const Be=[137,80,78,71,13,10,26,10],Un=[];for(let t=0;t<256;t++){let i=t;for(let e=0;e<8;e++)i&1?i=3988292384^i>>>1:i=i>>>1;Un[t]=i}const Wi=4294967295;function ks(t,i,e){let n=t;for(let a=0;a<e;a++)n=Un[(n^i[a])&255]^n>>>8;return n}function Es(t,i){return(ks(Wi,t,i)^Wi)>>>0}var ct;(function(t){t[t.UNKNOWN=-1]="UNKNOWN",t[t.GREYSCALE=0]="GREYSCALE",t[t.TRUECOLOUR=2]="TRUECOLOUR",t[t.INDEXED_COLOUR=3]="INDEXED_COLOUR",t[t.GREYSCALE_ALPHA=4]="GREYSCALE_ALPHA",t[t.TRUECOLOUR_ALPHA=6]="TRUECOLOUR_ALPHA"})(ct||(ct={}));var Pt;(function(t){t[t.UNKNOWN=-1]="UNKNOWN",t[t.DEFLATE=0]="DEFLATE"})(Pt||(Pt={}));var ue;(function(t){t[t.UNKNOWN=-1]="UNKNOWN",t[t.ADAPTIVE=0]="ADAPTIVE"})(ue||(ue={}));var we;(function(t){t[t.UNKNOWN=-1]="UNKNOWN",t[t.NO_INTERLACE=0]="NO_INTERLACE",t[t.ADAM7=1]="ADAM7"})(we||(we={}));const As=new Uint8Array(0),ji="\0",zs=new Uint16Array([255]),Ss=new Uint8Array(zs.buffer),Cs=Ss[0]===255;class Ts extends Ge{constructor(i,e={}){super(i);const{checkCrc:n=!1}=e;this._checkCrc=n,this._inflator=new vs,this._png={width:-1,height:-1,channels:-1,data:new Uint8Array(0),depth:1,text:{}},this._end=!1,this._hasPalette=!1,this._palette=[],this._compressionMethod=Pt.UNKNOWN,this._filterMethod=ue.UNKNOWN,this._interlaceMethod=we.UNKNOWN,this._colorType=-1,this.setBigEndian()}decode(){for(this.decodeSignature();!this._end;)this.decodeChunk();return this.decodeImage(),this._png}decodeSignature(){for(let i=0;i<Be.length;i++)if(this.readUint8()!==Be[i])throw new Error(`wrong PNG signature. Byte at ${i} should be ${Be[i]}.`)}decodeChunk(){const i=this.readUint32(),e=this.readChars(4),n=this.offset;switch(e){case"IHDR":this.decodeIHDR();break;case"PLTE":this.decodePLTE(i);break;case"IDAT":this.decodeIDAT(i);break;case"IEND":this._end=!0;break;case"tRNS":this.decodetRNS(i);break;case"iCCP":this.decodeiCCP(i);break;case"tEXt":this.decodetEXt(i);break;case"pHYs":this.decodepHYs();break;default:this.skip(i);break}if(this.offset-n!==i)throw new Error(`Length mismatch while decoding chunk ${e}`);if(this._checkCrc){const a=this.readUint32(),r=i+4,o=Es(new Uint8Array(this.buffer,this.byteOffset+this.offset-r-4,r),r);if(o!==a)throw new Error(`CRC mismatch for chunk ${e}. Expected ${a}, found ${o}`)}else this.skip(4)}decodeIHDR(){const i=this._png;i.width=this.readUint32(),i.height=this.readUint32(),i.depth=Ds(this.readUint8());const e=this.readUint8();this._colorType=e;let n;switch(e){case ct.GREYSCALE:n=1;break;case ct.TRUECOLOUR:n=3;break;case ct.INDEXED_COLOUR:n=1;break;case ct.GREYSCALE_ALPHA:n=2;break;case ct.TRUECOLOUR_ALPHA:n=4;break;default:throw new Error(`Unknown color type: ${e}`)}if(this._png.channels=n,this._compressionMethod=this.readUint8(),this._compressionMethod!==Pt.DEFLATE)throw new Error(`Unsupported compression method: ${this._compressionMethod}`);this._filterMethod=this.readUint8(),this._interlaceMethod=this.readUint8()}decodePLTE(i){if(i%3!==0)throw new RangeError(`PLTE field length must be a multiple of 3. Got ${i}`);const e=i/3;this._hasPalette=!0;const n=[];this._palette=n;for(let a=0;a<e;a++)n.push([this.readUint8(),this.readUint8(),this.readUint8()])}decodeIDAT(i){this._inflator.push(new Uint8Array(this.buffer,this.offset+this.byteOffset,i)),this.skip(i)}decodetRNS(i){if(this._colorType===3){if(i>this._palette.length)throw new Error(`tRNS chunk contains more alpha values than there are palette colors (${i} vs ${this._palette.length})`);let e=0;for(;e<i;e++){const n=this.readByte();this._palette[e].push(n)}for(;e<this._palette.length;e++)this._palette[e].push(255)}}decodeiCCP(i){let e="",n;for(;(n=this.readChar())!==ji;)e+=n;const a=this.readUint8();if(a!==Pt.DEFLATE)throw new Error(`Unsupported iCCP compression method: ${a}`);const r=this.readBytes(i-e.length-2);this._png.iccEmbeddedProfile={name:e,profile:ms(r)}}decodetEXt(i){let e="",n;for(;(n=this.readChar())!==ji;)e+=n;this._png.text[e]=this.readChars(i-e.length-1)}decodepHYs(){const i=this.readUint32(),e=this.readUint32(),n=this.readByte();this._png.resolution={x:i,y:e,unit:n}}decodeImage(){if(this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);const i=this._inflator.result;if(this._filterMethod!==ue.ADAPTIVE)throw new Error(`Filter method ${this._filterMethod} not supported`);if(this._interlaceMethod===we.NO_INTERLACE)this.decodeInterlaceNull(i);else throw new Error(`Interlace method ${this._interlaceMethod} not supported`)}decodeInterlaceNull(i){const e=this._png.height,n=this._png.channels*this._png.depth/8,a=this._png.width*n,r=new Uint8Array(this._png.height*a);let o=As,l=0,f,s;for(let h=0;h<e;h++){switch(f=i.subarray(l+1,l+1+a),s=r.subarray(h*a,(h+1)*a),i[l]){case 0:Rs(f,s,a);break;case 1:Us(f,s,a,n);break;case 2:Ms(f,s,o,a);break;case 3:Ns(f,s,o,a,n);break;case 4:Bs(f,s,o,a,n);break;default:throw new Error(`Unsupported filter: ${i[l]}`)}o=s,l+=a+1}if(this._hasPalette&&(this._png.palette=this._palette),this._png.depth===16){const h=new Uint16Array(r.buffer);if(Cs)for(let w=0;w<h.length;w++)h[w]=Ls(h[w]);this._png.data=h}else this._png.data=r}}function Rs(t,i,e){for(let n=0;n<e;n++)i[n]=t[n]}function Us(t,i,e,n){let a=0;for(;a<n;a++)i[a]=t[a];for(;a<e;a++)i[a]=t[a]+i[a-n]&255}function Ms(t,i,e,n){let a=0;if(e.length===0)for(;a<n;a++)i[a]=t[a];else for(;a<n;a++)i[a]=t[a]+e[a]&255}function Ns(t,i,e,n,a){let r=0;if(e.length===0){for(;r<a;r++)i[r]=t[r];for(;r<n;r++)i[r]=t[r]+(i[r-a]>>1)&255}else{for(;r<a;r++)i[r]=t[r]+(e[r]>>1)&255;for(;r<n;r++)i[r]=t[r]+(i[r-a]+e[r]>>1)&255}}function Bs(t,i,e,n,a){let r=0;if(e.length===0){for(;r<a;r++)i[r]=t[r];for(;r<n;r++)i[r]=t[r]+i[r-a]&255}else{for(;r<a;r++)i[r]=t[r]+e[r]&255;for(;r<n;r++)i[r]=t[r]+Os(i[r-a],e[r],e[r-a])&255}}function Os(t,i,e){const n=t+i-e,a=Math.abs(n-t),r=Math.abs(n-i),o=Math.abs(n-e);return a<=r&&a<=o?t:r<=o?i:e}function Ls(t){return(t&255)<<8|t>>8&255}function Ds(t){if(t!==1&&t!==2&&t!==4&&t!==8&&t!==16)throw new Error(`invalid bit depth: ${t}`);return t}var Gi;(function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.METRE=1]="METRE"})(Gi||(Gi={}));function Is(t,i){return new Ts(t,i).decode()}class Vs{constructor(i){g(this,"_filePath");g(this,"_width",0);g(this,"_height",0);g(this,"_data",[]);this._filePath=i}async load(){const e=await(await fetch(this._filePath)).arrayBuffer(),n=Is(e);this._width=n.width,this._height=n.height;for(let a=0;a<n.data.length;a+=4)this._data.push({r:n.data[a+0],g:n.data[a+1],b:n.data[a+2],a:n.data[a+3]});return this}get width(){return this._width}get height(){return this._height}get data(){return this._data}}class Zs{constructor(i,e=[]){g(this,"_points");g(this,"_texCoords");g(this,"_contrast","rgb(0, 0, 0)");this._points=i,this._texCoords=e}get points(){return this._points}get texCoords(){return this._texCoords}get contrast(){return this._contrast}set points(i){this._points=i}set texCoords(i){this._texCoords=i}set contrast(i){this._contrast=i}}class Fs{constructor(i,e,n,a,r,o){g(this,"_vertices");g(this,"_texCoords");this._vertices=[i,e,n],this._texCoords=[a,r,o]}get vertices(){return this._vertices}get texCoords(){return this._texCoords}generateTriangles(){const i=[];for(let e=0;e<this._vertices.length-2;e++){const n=[b.convertVec3ToVec4(this._vertices[0]),b.convertVec3ToVec4(this._vertices[e+1]),b.convertVec3ToVec4(this._vertices[e+2])],a=[this._texCoords[0],this._texCoords[e+1],this._texCoords[e+2]];i.push(new Zs(n,a))}return i}clip(i){this.clipPolygonByPlane(i.planes[ft.LEFT]),this.clipPolygonByPlane(i.planes[ft.RIGHT]),this.clipPolygonByPlane(i.planes[ft.TOP]),this.clipPolygonByPlane(i.planes[ft.BOTTOM]),this.clipPolygonByPlane(i.planes[ft.NEAR]),this.clipPolygonByPlane(i.planes[ft.FAR])}clipPolygonByPlane(i){const e=[],n=[];let a=0,r=this._vertices[this._vertices.length-1],o=this._texCoords[this._texCoords.length-1];if(!r||!o)return;let l=b.dotVec3(b.subtractVec3(r,i.point),i.normal);for(;a<this._vertices.length;){const f=this._vertices[a],s=b.dotVec3(b.subtractVec3(f,i.point),i.normal),h=this._texCoords[a];if(s*l<0){const w=l/(l-s),_=new v(Nt(r.x,f.x,w),Nt(r.y,f.y,w),Nt(r.z,f.z,w)),d={u:Nt(o.u,h.u,w),v:Nt(o.v,h.v,w)};e.push(_),n.push(d)}s>0&&(e.push(f),n.push(h)),r=f,l=s,o=h,a++}this._vertices=e,this._texCoords=n}}class Xi{constructor(i=new v){g(this,"_position");g(this,"_id",0);this._position=i}get position(){return this._position}set position(i){this._position=i}get id(){return this._id}set id(i){this._id=i}}class wt{static addLight(i){i.id=this.generateId(),this._lists.push(i)}static removeLight(i){this._lists=this._lists.filter(e=>e.id!==i)}static generateId(){return this._id++}static get list(){return this._lists}}g(wt,"_lists",[]),g(wt,"_id",0);class le{constructor(i,e="",n=new v,a=new v,r=new v(1,1,1)){g(this,"_mesh");g(this,"_texture",null);g(this,"_position",new v);g(this,"_rotation",new v);g(this,"_scale",new v(1,1,1));g(this,"_triangles",[]);this._mesh=new $n(i),this._texture=e?new Vs(e):this._texture,this._position=n,this._rotation=a,this._scale=r,this.load()}async load(){var i;this._mesh.load(),(i=this._texture)==null||i.load(),console.log(this._texture)}update(i){this._triangles=[];const e=kt.getCameras()[0];for(let n=0;n<this._mesh.faces.length;n++){const a=this._mesh.faces[n],r=[];r[0]=this._mesh.vertices[a.a],r[1]=this._mesh.vertices[a.b],r[2]=this._mesh.vertices[a.c];const o=[];for(let p=0;p<3;p++){let z=b.convertVec4ToVec3(b.multiplyMatrix4x4(De.scale4x4(this._scale.x,this._scale.y,this._scale.z),b.convertVec3ToVec4(r[p])));z=b.rotateZvec3(z,this._rotation.z),z=b.rotateYvec3(z,this._rotation.y),z=b.rotateXvec3(z,this._rotation.x),z=b.convertVec4ToVec3(b.multiplyMatrix4x4(De.translation4x4(this.position.x,this._position.y,this._position.z),b.convertVec3ToVec4(z))),z=b.convertVec4ToVec3(b.multiplyMatrix4x4(e.getViewMatrix(),b.convertVec3ToVec4(z))),o.push(z)}const l=b.subtractVec3(o[1],o[0]),f=b.subtractVec3(o[2],o[0]),s=b.crossVec3(l,f),h=b.subtractVec3(e.position,o[0]);if(i[Le]&&b.dotVec3(h,s)<0)continue;let w=0;if(wt.list.length>0)for(let p=0;p<wt.list.length;p++){const z=b.subtractVec3(wt.list[p].position,o[0]);let E=b.dotVec3(b.normalizeVec3(z),b.normalizeVec3(s));E=Math.floor((E*.5+.5)*255)*.3,w+=E}const _=new Fs(o[0],o[1],o[2],a.uvA,a.uvB,a.uvC);_.clip(e.frustum);const d=_.generateTriangles();for(let p=0;p<d.length;p++){const z=[],E=d[p];for(let m=0;m<3;m++){const A=b.multiplyMatrix4x4(e.projection,E.points[m]);A.x/=A.w,A.y/=A.w,A.x*=M.canvasView.width/2,A.y*=-M.canvasView.height/2,A.x+=M.canvasView.width/2,A.y+=M.canvasView.height/2,z.push(A)}E.points=z,E.contrast=`rgb(${w}, ${w}, ${w})`,this._triangles.push(E)}}}render(i){for(let e=0;e<this._triangles.length;e++){const n=this._triangles[e];i[X]&&M.drawTriangle(n.points[0].x,n.points[0].y,n.points[1].x,n.points[1].y,n.points[2].x,n.points[2].y,"green"),i[H]&&M.drawFilledTriangle(n.points[0].x,n.points[0].y,n.points[1].x,n.points[1].y,n.points[2].x,n.points[2].y,n.contrast),i[P]&&this._texture&&M.drawTexturedTriangle(n.points[0].x,n.points[0].y,n.points[0].z,n.points[0].w,n.texCoords[0].u,n.texCoords[0].v,n.points[1].x,n.points[1].y,n.points[1].z,n.points[1].w,n.texCoords[1].u,n.texCoords[1].v,n.points[2].x,n.points[2].y,n.points[2].z,n.points[2].w,n.texCoords[2].u,n.texCoords[2].v,this._texture),i[Oe]&&(M.drawRectangle(n.points[0].x,n.points[0].y,3,3,"red"),M.drawRectangle(n.points[1].x,n.points[1].y,3,3,"red"),M.drawRectangle(n.points[2].x,n.points[2].y,3,3,"red"))}}get position(){return this._position}get rotation(){return this._rotation}get scale(){return this._scale}set position(i){this._position=i}set rotation(i){this._rotation=i}set scale(i){this._scale=i}}const ni=class{constructor(){g(this,"_objects",[]);g(this,"_elapsedTime",0)}static getInstance(){return this._instance||(this._instance=new ni),this._instance}async setup(){if(M.init()){if(M.canvasViewCtx&&M.canvasColorBufferCtx){const i=new le("./assets/shark.obj","./assets/shark.png",new v(0,0,0),new v(0,Math.PI*.5,0)),e=new le("./assets/cow.obj","",new v(-.5,1.5,0),new v(0,0,0),new v(.002,.002,.002)),n=new le("./assets/cat.obj","",new v(2,-2.5,0),new v(0,Math.PI*.5,0),new v(.05,.05,.05)),a=new le("./assets/chicken.obj","",new v(-3,-2.5,0),new v(0,Math.PI*.5,0),new v(.03,.03,.03));this._objects.push(i),this._objects.push(e),this._objects.push(n),this._objects.push(a);const r=M.canvasView.width/M.canvasView.height,o=M.canvasView.height/M.canvasView.width,l=60,f=Bn(Math.atan(Math.tan(q(l)/2)*r))*2,s=.1,h=200;kt.addCamera(new v(0,0,-10),f,l,o,s,h),wt.addLight(new Xi(new v(5,5,0))),wt.addLight(new Xi(new v(-5,5,0)))}return!0}else throw Error("Canvas is Not Available")}update(i,e){this._elapsedTime=this._elapsedTime+e,this._objects[0].rotation=new v(0,this._elapsedTime*.2,0),this._objects[1].rotation=new v(0,-this._elapsedTime*.2,0),this._objects[2].rotation=new v(0,this._elapsedTime*.2,0),this._objects[3].rotation=new v(0,-this._elapsedTime*.2,0);const n=Zt.getInstance();kt.getCameras()[0].update(n.movementStates,n.mouseStates,e),n.mouseStates.dx=0,n.mouseStates.dy=0,this._objects.forEach(a=>a.update(i))}render(i){!M.canvasColorBufferCtx||!M.canvasViewCtx||(M.canvasColorBufferCtx.fillStyle="black",M.canvasColorBufferCtx.fillRect(0,0,M.canvasView.width,M.canvasView.height),M.clearZbuffer(),this._objects.forEach(e=>e.render(i)),M.canvasViewCtx.drawImage(M.canvasColorBufferCtx.canvas,0,0))}};let fe=ni;g(fe,"_instance");async function $s(){const t=Zt.getInstance();t.bindEvents();const i=fe.getInstance();let e=0;const n=r=>{const o=(r-e)*.001;e=r,i.update(t.renderingStates,o),i.render(t.renderingStates),requestAnimationFrame(n)};await i.setup()&&requestAnimationFrame(n)}$s();
